---
title: "warmXtrophic: OTC Data Plots"
author: "Kara Dobson"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
---

```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```
NOTE: this script is not updated - check the .R script for updated plots
COLLABORATORS: Phoebe Zarnetske, Nina Lany, Kathryn Schmidt, Mark Hammond, Pat Bills, Kileigh Welshofer, Moriah Young  
DATA INPUT: CSV files are located in the L1 hobo folder in the shared Google drive   
PROJECT: warmXtrophic  
DATE: July 2020, updated June 2021  




Guide  
Page 2: Pendant air temps from KBS and UMBS
Page 3: Yearly average air temperatures between KBS and UMBS  
Page 4: Monthly average air temperatures between KBS and UMBS for all years  
Page 5: Average July air temperatures between KBS and UMBS  
Page 6: KBS - Comparing PAR to HOBO between 2017-2019  
Page 7: KBS - Another comparison of PAR to HOBO from 2017-2019  
Page 8: KBS - Comparing PAR to HOBO for multiple 2019 dates & a linear regression between 2019 warmed chamber PAR and HOBO  
Page 9: UMBS linear regression between warmed temp and PAR  
Page 10: KBS soil temperature over time  
Page 11: KBS soil moisture over time  
Page 12: 1H sensor average air temperature by month over all years  
Page 13: 2H sensor average air temperature by month over all years  
Page 14: 3H sensor average air temperature by month over all years  
```{r, include = FALSE, message = FALSE}
library(tidyverse)
library(plotrix)
library(ggpubr)
# Set working directory
Sys.getenv("L1DIR")
L1_dir<-Sys.getenv("L1DIR")
list.files(L1_dir)
KBS_1 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/KBS/KBS_pair1_L1.csv"))
KBS_2 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/KBS/KBS_pair2_L1.csv"))
KBS_3 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/KBS/KBS_pair3_L1.csv"))
UMBS_1 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/UMBS/UMBS_pair1_L1.csv"))
UMBS_2 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/UMBS/UMBS_pair2_L1.csv"))
UMBS_3 <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_paired_sensor_data/UMBS/UMBS_pair3_L1.csv"))
KBS_par <- read.csv(file.path(L1_dir,"PAR_data/KBS_PAR_L1.csv"))
UMBS_par <- read.csv(file.path(L1_dir,"PAR_data/UMBS_PAR_L1.csv"))
KBS_pend <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_pendant_data/KBS/KBS_HOBOpendant_L1.csv"))
UMBS_pend <- read.csv(file.path(L1_dir,"HOBO_data/HOBO_pendant_data/UMBS/UMBS_HOBOpendant_L1.csv"))

test_KBS_1 <- KBS_1
test_KBS_1$month <- format(test_KBS_1$Date_Time,format="%m")
test_KBS_1$year <- format(test_KBS_1$Date_Time,format="%y")
mean_monthly_warmk1 <- aggregate( XH_warmed_air_1m ~ month + year , test_KBS_1 , mean )
mean_monthly_ambk1 <- aggregate( XH_ambient_air_1m ~ month + year, test_KBS_1, mean)
mean_monthlyk1 <- merge(mean_monthly_ambk1, mean_monthly_warmk1, by=c("month", "year"))
mean_monthly_gatherk1 <- mean_monthlyk1 %>%
  gather(key = "treatment",value="temp", -month, -year)

test_KBS_2 <- KBS_2
test_KBS_2$month <- format(test_KBS_2$Date_Time,format="%m")
test_KBS_2$year <- format(test_KBS_2$Date_Time,format="%y")
mean_monthly_warmk2 <- aggregate( XH_warmed_air_1m ~ month + year , test_KBS_2 , mean )
mean_monthly_ambk2 <- aggregate( XH_ambient_air_1m ~ month + year, test_KBS_2, mean)
mean_monthlyk2 <- merge(mean_monthly_ambk2, mean_monthly_warmk2, by=c("month", "year"))
mean_monthly_gatherk2 <- mean_monthlyk2 %>%
  gather(key = "treatment",value="temp", -month, -year)

test_KBS_3 <- KBS_3
test_KBS_3$month <- format(test_KBS_3$Date_Time,format="%m")
test_KBS_3$year <- format(test_KBS_3$Date_Time,format="%y")
mean_monthly_warmk3 <- aggregate( XH_warmed_air_1m ~ month + year , test_KBS_3 , mean )
mean_monthly_ambk3 <- aggregate( XH_ambient_air_1m ~ month + year, test_KBS_3, mean)
mean_monthlyk3 <- merge(mean_monthly_ambk3, mean_monthly_warmk3, by=c("month", "year"))
mean_monthly_gatherk3 <- mean_monthlyk3 %>%
  gather(key = "treatment",value="temp", -month, -year)

KBS <- rbind(KBS_1, KBS_2, KBS_3)
KBS_season <- KBS
KBS_season$month <- format(KBS_season$Date_Time,format="%m")
KBS_season$year <- format(KBS_season$Date_Time,format="%Y")
KBS_season$hour <- format(KBS_season$Date_Time, format="%H")
KBS_season <- KBS_season %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XH_warmed_air_1m, XH_ambient_air_1m)
KBS_avg_month <- KBS_season %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(month, year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
KBS_avg_year <- KBS_season %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
KBS_season2 <- KBS_season %>%
  filter(month == "07") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XH_warmed_air_1m, XH_ambient_air_1m)
KBS_avg_july <- KBS_season2 %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(month, year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
KBS_season_soil <- KBS
KBS_season_soil$month <- format(KBS_season_soil$Date_Time,format="%m")
KBS_season_soil$year <- format(KBS_season_soil$Date_Time,format="%y")
KBS_season_soil$hour <- format(KBS_season_soil$Date_Time, format="%H")
KBS_season_soil <- KBS_season_soil %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XU_warmed_soil_temp_5cm, XU_ambient_soil_temp_5cm)
KBS_avg_soil <- KBS_season_soil %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
KBS_season_moist <- KBS
KBS_season_moist$month <- format(KBS_season_moist$Date_Time,format="%m")
KBS_season_moist$year <- format(KBS_season_moist$Date_Time,format="%y")
KBS_season_moist$hour <- format(KBS_season_moist$Date_Time, format="%H")
KBS_season_moist <- KBS_season_moist %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XH_warmed_soil_moisture_5cm, XH_ambient_soil_moisture_5cm)
KBS_avg_moist <- KBS_season_moist %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))

UMBS <- rbind(UMBS_1, UMBS_2, UMBS_3)
UMBS_season <- UMBS
UMBS_season$month <- format(UMBS_season$Date_Time,format="%m")
UMBS_season$year <- format(UMBS_season$Date_Time,format="%Y")
UMBS_season$hour <- format(UMBS_season$Date_Time, format="%H")
UMBS_season <- UMBS_season %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XH_warmed_air_1m, XH_ambient_air_1m)
UMBS_avg_month <- UMBS_season %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(month, year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
UMBS_avg_year <- UMBS_season %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))
UMBS_season2 <- UMBS_season %>%
  filter(month == "07") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, XH_warmed_air_1m, XH_ambient_air_1m)
UMBS_avg_july <- UMBS_season2 %>%
  gather(key = "treatment", value = "temp", -year, -month, -hour, -Date_Time) %>%
  group_by(month, year, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se = std.error(temp, na.rm = TRUE))

KBS_hobo <- KBS
KBS_hobo$month <- format(KBS_hobo$Date_Time,format="%m")
KBS_hobo$year <- format(KBS_hobo$Date_Time,format="%Y")
KBS_hobo$day <- format(KBS_hobo$Date_Time,format="%d")
KBS_hobo1 <- KBS_hobo %>%
  select(Date_Time, year, month, day, XH_warmed_air_1m, XH_ambient_air_1m) %>%
  gather(key = "treatment", value = "temp", -year, -month, -day, -Date_Time) %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se_temp = std.error(temp, na.rm = TRUE)) %>%
  filter(year == "2017" & month == "07" & day == "04"|
           year == '2018' & month == '08' & day == '23'|
           year == '2019' & month == '08' & day == '02')
KBS_hobo2 <- KBS_hobo %>%
  select(Date_Time, year, month, day, XH_warmed_air_1m, XH_ambient_air_1m) %>%
  gather(key = "treatment", value = "temp", -year, -month, -day, -Date_Time) %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se_temp = std.error(temp, na.rm = TRUE)) %>%
  filter(year == "2019" & month == "05" & day == "15"|
           year == '2019' & month == '07' & day == '08'|
           year == '2019' & month == '08' & day == '02'|
           year == '2019' & month == '08' & day == '29'|
           year == '2019' & month == '09' & day == '18')
KBS_par$month <- format(KBS_par$Date_Time,format="%m")
KBS_par$year <- format(KBS_par$Date_Time,format="%Y")
KBS_par$day <- format(KBS_par$Date_Time,format="%d")
KBS_par1 <- KBS_par %>%
  select(Date_Time, Plot, year, month, day, Percent_Sunlight) %>%
  filter(year == "2017" & month == "07" & day == "04"|
           year == '2018' & month == '08' & day == '23'|
           year == '2019' & month == '08' & day == '02') %>%
  filter(Plot == "B6"|Plot == "A6"|Plot == "B3"|Plot == "B4"|Plot == "C1"|Plot == "B1")
KBS_par2 <- KBS_par %>%
  select(Date_Time, Plot, year, month, day, Percent_Sunlight) %>%
  filter(year == "2019" & month == "05" & day == "15"|
           year == '2019' & month == '07' & day == '08'|
           year == '2019' & month == '08' & day == '02'|
           year == '2019' & month == '08' & day == '29'|
           year == '2019' & month == '09' & day == '18') %>%
  filter(Plot == "B6"|Plot == "A6"|Plot == "B3"|Plot == "B4"|Plot == "C1"|Plot == "B1")
par_names <- c(B6="XH_warmed_air_1m", B3="XH_warmed_air_1m", C1="XH_warmed_air_1m", 
                A6="XH_ambient_air_1m", B4="XH_ambient_air_1m", B1="XH_ambient_air_1m")
KBS_par1$treatment <- as.character(par_names[KBS_par1$Plot])
KBS_par2$treatment <- as.character(par_names[KBS_par2$Plot])
KBS_par1 <- KBS_par1 %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_par = mean(Percent_Sunlight, na.rm = TRUE),
            se_par = std.error(Percent_Sunlight, na.rm = TRUE))
KBS_par2 <- KBS_par2 %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_par = mean(Percent_Sunlight, na.rm = TRUE),
            se_par = std.error(Percent_Sunlight, na.rm = TRUE))
KBS_comb <- merge(KBS_hobo1,KBS_par1,by=c("year","month","day","treatment"))
KBS_comb2 <- merge(KBS_hobo2,KBS_par2,by=c("year","month","day","treatment"))
ym <- c(paste0(KBS_comb$year,'_',KBS_comb$month,'_',KBS_comb$day))
KBS_comb <- data.frame(KBS_comb,ym)
ym2 <- c(paste0(KBS_comb2$year,'_',KBS_comb2$month,'_',KBS_comb2$day))
KBS_comb_2019 <- data.frame(KBS_comb2,ym2)


UMBS_hobo <- UMBS
UMBS_hobo$month <- format(UMBS_hobo$Date_Time,format="%m")
UMBS_hobo$year <- format(UMBS_hobo$Date_Time,format="%Y")
UMBS_hobo$day <- format(UMBS_hobo$Date_Time,format="%d")
UMBS_hobo1 <- UMBS_hobo %>%
  select(Date_Time, year, month, day, XH_warmed_air_1m, XH_ambient_air_1m) %>%
  gather(key = "treatment", value = "temp", -year, -month, -day, -Date_Time) %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_temp = mean(temp, na.rm = TRUE),
            se_temp = std.error(temp, na.rm = TRUE)) %>%
  filter(year == "2017" & month == "07" & day == "03"|
           year == '2017' & month == '07' & day == '10'|
           year == '2017' & month == '07' & day == '17'|
           year == '2017' & month == '07' & day == '24'|
           year == '2017' & month == '08' & day == '09'|
           year == '2017' & month == '08' & day == '16'|
           year == '2018' & month == '08' & day == '03'|
           year == '2018' & month == '08' & day == '13'|
           year == '2018' & month == '08' & day == '22'|
           year == '2018' & month == '08' & day == '31'|
           year == '2018' & month == '09' & day == '07'|
           year == '2018' & month == '09' & day == '13'|
           year == '2019' & month == '06' & day == '03'|
           year == '2019' & month == '06' & day == '18'|
           year == '2019' & month == '07' & day == '28')
UMBS_par$month <- format(UMBS_par$Date_Time,format="%m")
UMBS_par$year <- format(UMBS_par$Date_Time,format="%Y")
UMBS_par$day <- format(UMBS_par$Date_Time,format="%d")
UMBS_par1 <- UMBS_par %>%
  select(Date_Time, Plot, year, month, day, Percent_Sunlight) %>%
  filter(Plot == "A5"|Plot == "A6"|Plot == "B4"|Plot == "C4"|Plot == "C2"|Plot == "D2")
par_names2 <- c(A5="XH_warmed_air_1m", C4="XH_warmed_air_1m", D2="XH_warmed_air_1m", 
               A6="XH_ambient_air_1m", B4="XH_ambient_air_1m", C2="XH_ambient_air_1m")
UMBS_par1$treatment <- as.character(par_names2[UMBS_par1$Plot])
UMBS_par1 <- UMBS_par1 %>%
  group_by(month, year, day, treatment) %>%
  summarize(average_par = mean(Percent_Sunlight, na.rm = TRUE),
            se_par = std.error(Percent_Sunlight, na.rm = TRUE))
UMBS_comb <- merge(UMBS_hobo1,UMBS_par1,by=c("year","month","day","treatment")) # over the years
ym3 <- c(paste0(UMBS_comb$year,'_',UMBS_comb$month,'_',UMBS_comb$day))
UMBS_comb <- data.frame(UMBS_comb,ym3)

UMBS_pend_season <- UMBS_pend
UMBS_pend_season$month <- format(UMBS_pend_season$Date_Time,format="%m")
UMBS_pend_season$year <- format(UMBS_pend_season$Date_Time,format="%Y")
UMBS_pend_season$hour <- format(UMBS_pend_season$Date_Time, format="%H")
UMBS_pend_season <- UMBS_pend_season %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  na.omit(Temp_F_XP_air_1m) %>%
  select(Date_Time, year, month, hour, Pendant_ID, Temp_F_XP_air_1m)

KBS_pend_season <- KBS_pend
KBS_pend_season$month <- format(KBS_pend_season$Date_Time,format="%m")
KBS_pend_season$year <- format(KBS_pend_season$Date_Time,format="%Y")
KBS_pend_season$hour <- format(KBS_pend_season$Date_Time, format="%H")
KBS_pend_season <- KBS_pend_season %>%
  filter(month > "03") %>%
  filter(month < "09") %>%
  filter(hour > "06") %>%
  filter(hour < "20") %>%
  select(Date_Time, year, month, hour, Pendant_ID, Temp_F_XP_air_1m)
```

```{r, echo = FALSE, message=FALSE}
ggplot(KBS_pend_season, aes(x = Pendant_ID, y = Temp_F_XP_air_1m)) +
  facet_grid(.~year) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "KBS")

ggplot(UMBS_pend_season, aes(x = Pendant_ID, y = Temp_F_XP_air_1m)) +
  facet_grid(.~year) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "UMBS")
```

## Yearly average chamber temperatures during the day for the growing season (I defined this as April-August from 7 AM - 7 PM, but this could easily be changed)  
## p-value < 0.001 for all
```{r, echo = FALSE, message=FALSE}
k_year <- ggplot(KBS_avg_year, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(title = "KBS", x=NULL, y = NULL, fill = "Treatment")
u_year <- ggplot(UMBS_avg_year, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(title = "UMBS", x="Year", y = NULL, fill = "Treatment")
final_year <- ggarrange(k_year, u_year, nrow = 2, common.legend = TRUE, legend = "bottom")
annotate_figure(final_year,
                left = text_grob("Average Temperature (°C)", color = "black", rot = 90))
```





## Monthly averages during the growing season, over time (KBS on top and UMBS on bottom) — these could be separated to see individual months over time (i.e. July temps over each year, as shown on the next page)
```{r, echo = FALSE, message=FALSE}
k_month <- ggplot(KBS_avg_month, aes(x = month, y = average_temp, fill = treatment)) + 
  facet_grid(.~year) +
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(x = NULL, y = NULL, fill = "Treatment")
u_month <- ggplot(UMBS_avg_month, aes(x = month, y = average_temp, fill = treatment)) + 
  facet_grid(.~year) +
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(x="Month", y = NULL, fill = "Treatment")
final_month <- ggarrange(k_month, u_month, nrow = 2, common.legend = TRUE, legend = "bottom")
annotate_figure(final_month,
                left = text_grob("Average Temperature (°C)", color = "black", rot = 90),
                top = text_grob("Year"))
```

## Average July temperatures during the daytime - KBS shows a smaller difference between warmed + ambient in later years than UMBS
```{r, echo = FALSE, message=FALSE}
k_july <- ggplot(KBS_avg_july, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.1,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(title = "KBS - July", x=NULL, y = NULL, fill = "Treatment")
u_july <- ggplot(UMBS_avg_july, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(position = "identity", alpha = 0.5, stat = "identity", color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.1,
                position = "identity") +
  ylim(0, 30) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue'))+
  theme_classic() +
  labs(title = "UMBS - July", x="Year", y = NULL, fill = "Treatment")
final_july <- ggarrange(k_july, u_july, nrow = 2, common.legend = TRUE, legend = "bottom")
annotate_figure(final_july,
                left = text_grob("Average Temperature (°C)", color = "black", rot = 90))
```

## KBS - Comparing PAR to HOBO from 2017-2019; only one day is shown for each year because PAR measurements were only taken on one day at KBS for 2017 and 2018
```{r, echo = FALSE, message=FALSE}
ggplot(KBS_comb, aes(x=ym, fill=treatment, color = treatment)) +
  geom_bar( aes(y=average_temp), position = "identity",alpha = 0.5, stat = "identity", color = 'black') + 
  geom_errorbar(aes(ymin = average_temp - se_temp, ymax = average_temp + se_temp), width = 0.05,
                position = "identity", color = 'black') +
  geom_point( aes(y=average_par * 100), size=2) +
  geom_line(aes(y = average_par * 100, group = treatment)) +
  scale_y_continuous(
    name = "Air Temperature (°C)",
    sec.axis = sec_axis(~./100, name="PAR")) + 
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('darkblue','lightblue')) +
  scale_color_manual(labels = c("Ambient", "Warmed"), values=c('black','white'))+
  theme_classic()
```

## KBS - Again, comparing PAR to HOBO, this time in line format - PAR in dashed lines
```{r, echo = FALSE, message=FALSE}
ggplot(KBS_comb, aes(x = ym, color = treatment, shape = treatment)) +
  geom_point(aes(y = average_temp)) +
  geom_point(aes(y = average_par * 100)) +
  geom_line(aes(y = average_temp, group = treatment)) +
  geom_line(aes(y = average_par * 100, group = treatment), linetype = "dashed") +
  scale_y_continuous(
    name = "Air Temperature (°C)",
    sec.axis = sec_axis(~./100, name="PAR")) + 
  labs(x = "Year, month, day") +
  scale_color_manual(labels = c("Ambient", "Warmed"), name = "Treatment", values=c('midnightblue','coral')) +
  scale_shape_manual(labels = c("Ambient", "Warmed"), name = "Treatment", values=c(17,16)) +
  theme_classic() +
  theme(legend.position="bottom")
```

## KBS- Comparing PAR to HOBO for only 2019 because multiple PAR measurements were taken that year - PAR in dashed lines
```{r, echo = FALSE, message=FALSE}
ggplot(KBS_comb_2019, aes(x = ym2, color = treatment, shape = treatment)) +
  geom_point(aes(y = average_temp)) +
  geom_point(aes(y = average_par * 100)) +
  geom_line(aes(y = average_temp, group = treatment)) +
  geom_line(aes(y = average_par * 100, group = treatment), linetype = 'dashed') +
  scale_y_continuous(
    name = "Air Temperature (°C)",
    sec.axis = sec_axis(~./100, name="PAR")) + 
  labs(x = "Year, month, day") +
  scale_color_manual(labels = c("Ambient", "Warmed"), name = "Treatment", values=c('midnightblue','coral')) +
  scale_shape_manual(labels = c("Ambient", "Warmed"), name = "Treatment", values=c(17,16)) +
  theme_classic()+
  theme(legend.position="bottom")
```

## KBS - Simple linear regression between temp and par: F(1,3) = 32.21, p-value = 0.011
```{r, echo = FALSE, message=FALSE}
KBS_comb_lm <- KBS_comb_2019 %>%
  filter(treatment == "XH_warmed_air_1m")
lm_kbs <- lm(average_temp ~ average_par, data = KBS_comb_lm)
plot(average_temp ~ average_par, data = KBS_comb_lm)
abline(lm_kbs)
```

## UMBS - Simple linear regression between temp and par: F(1,13) = 1.45, p-value = 0.25
```{r, echo = FALSE, message=FALSE}
UMBS_comb_lm <- UMBS_comb %>%
  filter(treatment == "XH_warmed_air_1m")
lm_umbs <- lm(average_temp ~ average_par, data = UMBS_comb_lm)
plot(average_temp ~ average_par, data = UMBS_comb_lm)
abline(lm_umbs)
```

## Soil temperature over time - varies between ambient or warmed treatments
## no sig difference for 2018 (p-value = 0.87)
```{r, echo = FALSE, message=FALSE}
ggplot(KBS_avg_soil, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(stat = "identity", position = position_dodge(), color = 'black') +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = position_dodge(0.9)) +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('#a3b4d3','#d8ecf2'))+
  theme_classic() +
  labs(title = "KBS", x="Year", y = "Average Soil Temperature (°C)", fill = "Treatment") +
  theme(legend.position = "bottom")
```

## Soil moisture over time - ambient retains more moisture (p-value < 0.001 for all)
```{r, echo = FALSE, message=FALSE}
ggplot(KBS_avg_moist, aes(x = year, y = average_temp, fill = treatment)) + 
  geom_bar(position = "identity", stat = "identity", color = 'black', alpha = 1) +
  geom_errorbar(aes(ymin = average_temp - se, ymax = average_temp + se), width = 0.2,
                position = "identity") +
  scale_fill_manual(labels = c("Ambient", "Warmed"), values=c('#a3b4d3','#d8ecf2'))+
  theme_classic() +
  labs(title = "KBS", x="Year", y = "Soil Moisture", fill = "Treatment")
```

## These plots average the chamber temperatures for each month over all years for each treatment

### 1H sensor
```{r, echo = FALSE, message=FALSE}
ggplot(mean_monthly_gatherk1, aes(x = as.numeric(month), y = temp)) +
  geom_point(aes(col = treatment, shape = year), size = 1) +
  geom_smooth(method = "loess", aes(linetype = treatment, col = treatment), size = 1.2,
              fill = "grey90") +
  labs(x = "Month",y = "Temperature °C") +
  theme_minimal() + 
  theme(legend.position = "bottom") +
  scale_x_discrete(limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"))
```

### 2H sensor
```{r, echo = FALSE, message=FALSE}
ggplot(mean_monthly_gatherk2, aes(x = as.numeric(month), y = temp)) +
  geom_point(aes(col = treatment, shape = year), size = 1) +
  geom_smooth(method = "loess", aes(linetype = treatment, col = treatment), size = 1.2,
              fill = "grey90") +
  labs(x = "Month",y = "Temperature °C") +
  theme_minimal() + 
  theme(legend.position = "bottom") +
  scale_x_discrete(limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"))
```

### 3H sensor
```{r, echo = FALSE, message=FALSE}
ggplot(mean_monthly_gatherk3, aes(x = as.numeric(month), y = temp)) +
  geom_point(aes(col = treatment, shape = year), size = 1) +
  geom_smooth(method = "loess", aes(linetype = treatment, col = treatment), size = 1.2,
              fill = "grey90") +
  labs(x = "Month",y = "Temperature °C") +
  theme_minimal() + 
  theme(legend.position = "bottom") +
  scale_x_discrete(limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"))
```

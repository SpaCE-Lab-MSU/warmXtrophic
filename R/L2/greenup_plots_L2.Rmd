---
title: "Greenup Plots"
author: "Kara Dobson"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

COLLABORATORS: Phoebe Zarnetske, Mark Hammond, Pat Bills, Moriah Young  
DATA INPUT: Plot and species level greenup files from warmX Google drive  
DATA OUTPUT: Plots of greenup at KBS and UMBS - Rmd and PDF located in Github folder
PROJECT: warmXtrophic  


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Clear all existing data
rm(list=ls())

# Load packages
library(tidyverse)
library(plotrix)

# Set working directory
#Sys.getenv("L1DIR")
L1_dir<-Sys.getenv("L1DIR")
L2_dir<-Sys.getenv("L2DIR")
#list.files(L1_dir)

# Read in data
gr_plot <- read.csv(file.path(L2_dir, "greenup/final_greenup_plot_L2.csv"))
gr_species <- read.csv(file.path(L2_dir, "greenup/final_greenup_species_L2.csv"))
gr_growth <- read.csv(file.path(L2_dir, "greenup/final_greenup_growthhabit_L2.csv"))
gr_origin <- read.csv(file.path(L2_dir, "greenup/final_greenup_origin_L2.csv"))

# remove uneeded X column
gr_species$X <- NULL
gr_plot$X <- NULL
gr_growth$X <- NULL
gr_origin$X <- NULL

# filter data to contain the averages and std error for each site & species
sum_green_spp <- gr_species %>%
  group_by(site, state, species, year) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))

# filter data to contain the averages and std error for each site
sum_green_site <- gr_species %>%
  group_by(site, state, year) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))

# filter data to contain the averages and std error for each site
sum_green_site_min <- gr_species %>%
  group_by(site, state, year) %>%
  summarize(avg_julian = mean(min_green_date, na.rm = TRUE),
            se = std.error(min_green_date, na.rm = TRUE))

# by plant origin (native/exotic)
sum_green_org <- gr_species %>%
  group_by(site, origin, state) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))
sum_green_org <- subset(sum_green_org, origin == "Exotic" | origin == "Native")

# by plant growth type (forb, graminoid, shrub)
sum_green_habit <- gr_species %>%
  group_by(site, growth_habit, state) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))
sum_green_habit <- subset(sum_green_habit, growth_habit == "Forb" | growth_habit == "Graminoid" | growth_habit == "Shrub")
```

## Bar plot for greenup for KBS and UMBS - Species half cover date
```{r, echo = F}
greenup_plot_all <- function(loc) { 
  greenup_spp <- subset(sum_green_site, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_all("kbs")
greenup_plot_all("umbs")
```

## Box plot for greenup for KBS and UMBS - Species half cover date
```{r, echo = F}
greenup_plot_box <- function(loc) { 
  greenup_spp <- subset(gr_species, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = spp_half_cover_date, fill = state)) +
           facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_box("kbs")
greenup_plot_box("umbs")
```

## Box plot for greenup for KBS and UMBS - Plot half cover date
```{r, echo = F}
greenup_plot_boxp <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = state, y = plot_half_cover_date, fill = state)) +
           facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_boxp("kbs")
greenup_plot_boxp("umbs")
```

## Bar plot for greenup for KBS and UMBS - Species min cover date
```{r, echo = F}
greenup_plot_all <- function(loc) { 
  greenup_spp <- subset(sum_green_site_min, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_all("kbs")
greenup_plot_all("umbs")
```

## Box plot for greenup for KBS and UMBS - Species min cover date
```{r, echo = F}
greenup_plot_box <- function(loc) { 
  greenup_spp <- subset(gr_species, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = min_green_date, fill = state)) +
           facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_box("kbs")
greenup_plot_box("umbs")
```

## Plot for warmed vs ambient greenup between native and exotic - Species half cover date
```{r, echo = F}
greenup_plot_org <- function(loc) { 
  greenup_spp <- subset(sum_green_org, site == loc)
  return(ggplot(greenup_spp, aes(x = origin, y = avg_julian, fill = state)) +
           #facet_grid(.~year) +
           geom_bar(position = "dodge", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = position_dodge(0.9)) +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_org("kbs")
greenup_plot_org("umbs")     
```

## Plot for warmed vs ambient greenup between native and exotic - Plot half cover date
```{r, echo = F}
greenup_plot_org2 <- function(loc) { 
  greenup_plot <- subset(gr_origin, site == loc)
  return(ggplot(greenup_plot, aes(x = origin, y = origin_half_cover_date, fill = state)) +
           #facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}

greenup_plot_org2("kbs")
greenup_plot_org2("umbs")     
```

## Plot for warmed vs ambient greenup between growth types - Species half cover date
```{r, echo = F}
greenup_plot_habit <- function(loc) { 
  greenup_spp <- subset(sum_green_habit, site == loc)
  return(ggplot(greenup_spp, aes(x = growth_habit, y = avg_julian, fill = state)) +
           #facet_grid(.~year) +
           geom_bar(position = "dodge", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = position_dodge(0.9)) +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_habit("kbs")
greenup_plot_habit("umbs")  
```

## Plot for warmed vs ambient greenup between growth types - Plot half cover date
```{r, echo = F}
greenup_plot_habit2 <- function(loc) { 
  greenup_plot <- subset(gr_growth, site == loc)
  return(ggplot(greenup_plot, aes(x = growth_habit, y = habit_half_cover_date, fill = state)) +
           #facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}

greenup_plot_habit2("kbs")
greenup_plot_habit2("umbs")     
```

## Greenup plot for a given site and species - half cover date
### Ex: Soca at KBS, Cest at UMBS
```{r, echo = F}
greenup_plot <- function(spp, loc) { 
  greenup_spp <- subset(sum_green_spp, species == spp & site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = spp) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           #coord_cartesian(ylim = c(100, 250)) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot("Soca", "kbs")
greenup_plot("Cest", "umbs")
```


---
title: "Greenup Plots"
author: "Kara Dobson"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

COLLABORATORS: Phoebe Zarnetske, Mark Hammond, Pat Bills, Moriah Young  
DATA INPUT: Plot and species level greenup files from warmX Google drive  
DATA OUTPUT: Plots of greenup at KBS and UMBS - Rmd and PDF located in Github folder
PROJECT: warmXtrophic  


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Clear all existing data
rm(list=ls())

# Load packages
library(plotrix)
library(tidyverse)
library(ggpubr)
library(hrbrthemes)

# Set working directory
#Sys.getenv("L1DIR")
L1_dir<-Sys.getenv("L1DIR")
L2_dir<-Sys.getenv("L2DIR")
#list.files(L1_dir)

# Read in data
gr_plot <- read.csv(file.path(L2_dir, "greenup/final_greenup_plot_L2.csv"))
gr_species <- read.csv(file.path(L2_dir, "greenup/final_greenup_species_L2.csv"))
gr_growth <- read.csv(file.path(L2_dir, "greenup/final_greenup_growthhabit_L2.csv"))
gr_origin <- read.csv(file.path(L2_dir, "greenup/final_greenup_origin_L2.csv"))

flwr_spp <- read.csv(file.path(L2_dir, "phenology/final_flwr_species_L2.csv"))
flwr_plot <- read.csv(file.path(L2_dir, "phenology/final_flwr_plot_L2.csv"))
sd_spp <- read.csv(file.path(L2_dir, "phenology/final_sd_species_L2.csv"))
sd_plot <- read.csv(file.path(L2_dir, "phenology/final_sd_plot_L2.csv"))

# remove uneeded X column
gr_species$X <- NULL
gr_plot$X <- NULL
gr_growth$X <- NULL
gr_origin$X <- NULL

# making site names capital for cleaner plots
change_site <- function(df){
  df$site[df$site == "umbs"] <- "UMBS"
  df$site[df$site == "kbs"] <- "KBS"
  return(df)
}
gr_plot <- change_site(gr_plot)
sd_plot <- change_site(sd_plot)
flwr_plot <- change_site(flwr_plot)

# creating a vector with cleaned up insecticide labels for plotting
insect_labels <- c("insects" = "Herbivory", "no_insects" = "Reduced Herbivory")

# filter data to contain the averages and std error for each site & species
sum_green_spp <- gr_species %>%
  group_by(site, state, species, year) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))

# filter data to contain the averages and std error for each site - half cover
sum_green_site <- gr_species %>%
  group_by(site, state, year) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))

# filter data to contain the averages and std error for each site - minimum greenup date
sum_green_site_min <- gr_species %>%
  group_by(site, state, year) %>%
  summarize(avg_julian = mean(min_green_date, na.rm = TRUE),
            se = std.error(min_green_date, na.rm = TRUE))

# by plant origin (native/exotic)
sum_green_org <- gr_species %>%
  group_by(site, origin, state) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))
sum_green_org <- subset(sum_green_org, origin == "Exotic" | origin == "Native")

# by plant growth type (forb, graminoid, shrub)
sum_green_habit <- gr_species %>%
  group_by(site, growth_habit, state) %>%
  summarize(avg_julian = mean(spp_half_cover_date, na.rm = TRUE),
            se = std.error(spp_half_cover_date, na.rm = TRUE))
sum_green_habit <- subset(sum_green_habit, growth_habit == "Forb" | growth_habit == "Graminoid" | growth_habit == "Shrub")
```

## Bar plot for greenup for KBS and UMBS - Species half cover date
```{r, echo = F}
greenup_plot_all <- function(loc) { 
  greenup_spp <- subset(sum_green_site, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_all("kbs")
greenup_plot_all("umbs")
```

## Box plot for greenup for KBS and UMBS - Species half cover date
```{r, echo = F}
gr_species$year <- as.character(gr_species$year)
greenup_plot_box <- function(loc) { 
  greenup_spp <- subset(gr_species, site == loc)
  return(ggplot(greenup_spp, aes(x = year, y = spp_half_cover_date, fill = state)) +
                 facet_grid(.~insecticide) +
                 geom_boxplot(color = "black") +
                 labs(x = NULL, y = NULL, title = loc) +
                 scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                 scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
                 theme_classic())
}
spp_kbs <- greenup_plot_box("kbs")
spp_umbs <- greenup_plot_box("umbs")

spp_level <- ggarrange(spp_kbs, spp_umbs, nrow = 2, common.legend = T, legend="right")
#png("greenup_plots_L2_spp_greenup.png", units="in", width=8, height=8, res=300)
annotate_figure(spp_level,
                left = text_grob("Julian date of species-level green-up", color = "black", rot = 90),
                bottom = text_grob("Year", color = "black"))
#dev.off()
```

## Box plot for greenup for KBS and UMBS - Plot half cover date
```{r, echo = F}
gr_plot$year <- as.character(gr_plot$year)
greenup_plot_boxp <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = year, y = plot_half_cover_date, fill = state)) +
           facet_grid(.~insecticide) +
           geom_boxplot(color = "black") +
           labs(x = NULL, y = NULL, title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
plot_kbs <- greenup_plot_boxp("KBS")
plot_umbs <- greenup_plot_boxp("UMBS")

plot_level <- ggarrange(plot_kbs, plot_umbs, nrow = 2, common.legend = T, legend="right")
#png("greenup_plots_L2_plot_greenup.png", units="in", width=8, height=8, res=300)
annotate_figure(plot_level,
                left = text_grob("Julian date of plot-level green-up", color = "black", rot = 90),
                bottom = text_grob("Year", color = "black"))
#dev.off()
```

## Averaging greenup over all years - plot level
```{r, echo=F}
greenup_overall_plot <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = state, y = plot_half_cover_date, fill = state)) +
           facet_grid(.~insecticide, labeller = as_labeller(insect_labels)) +
           geom_boxplot() +
           labs(x = NULL, y = NULL, title = loc, fill="Treatment") +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "Ambient", "warmed" = "Warmed")) +
           theme_classic()) +
          theme(text = element_text(family="AvantGarde")) # doesn't work
}
plot_overall_kbs <- greenup_overall_plot("KBS")
plot_overall_umbs <- greenup_overall_plot("UMBS")

plot_level_overall <- ggarrange(plot_overall_kbs, plot_overall_umbs, nrow = 2, legend="none")
png("greenup_plots_L2_plot_greenup_overall.png", units="in", width=8, height=8, res=300)
annotate_figure(plot_level_overall,
                left = text_grob("Julian date of plot-level green-up", color = "black", rot = 90),
                bottom = text_grob("Treatment", color = "black"))
dev.off()
```

## Averaging greenup over all years - species level
```{r, echo=F}
greenup_overall_spp <- function(loc) { 
  greenup_spp <- subset(gr_species, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = spp_half_cover_date)) +
           facet_grid(.~insecticide) +
           geom_boxplot(color = "black") +
           labs(x = NULL, y = NULL, title = loc) +
           #scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           #scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
spp_overall_kbs <- greenup_overall_spp("kbs")
spp_overall_umbs <- greenup_overall_spp("umbs")

spp_level_overall <- ggarrange(spp_overall_kbs, spp_overall_umbs, nrow = 2, common.legend = T, legend="right")
#png("greenup_plots_L2_spp_greenup_overall.png", units="in", width=8, height=8, res=300)
annotate_figure(spp_level_overall,
                left = text_grob("Julian date of species-level green-up", color = "black", rot = 90),
                bottom = text_grob("Year", color = "black"))
#dev.off()
```

## Combining greenup, flower, and seed into one figure - plot level
```{r, echo=F}
# green-up plots
greenup_overall_plot2 <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = state, y = plot_half_cover_date, fill=state)) +
           facet_grid(.~insecticide, labeller = as_labeller(insect_labels)) +
           geom_boxplot(outlier.shape=NA, alpha=0.7) +
           geom_jitter(aes(alpha=0.8, color=state, fill=state), shape=16, size=2) +
           labs(x = NULL, y = "Green-up median julian date", title = loc) +
           scale_color_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "Ambient", "warmed" = "Warmed")) +
           theme_classic()) +
          theme(text = element_text(family="AvantGarde")) # doesn't work
}
plot_overall_kbs2 <- greenup_overall_plot2("KBS")
plot_overall_kbs2 <- plot_overall_kbs2 + theme(axis.text.x=element_blank())
plot_overall_umbs2 <- greenup_overall_plot2("UMBS")
plot_overall_umbs2 <- plot_overall_umbs2 + labs(y=NULL) + theme(axis.text.x=element_blank())

# flower plots
flwr_overall_plot <- function(loc) { 
  flower_plot <- subset(flwr_plot, site == loc)
  return(ggplot(flower_plot, aes(x = state, y = julian_median, fill=state)) +
           facet_grid(.~insecticide, labeller = as_labeller(insect_labels)) +
           geom_boxplot(outlier.shape=NA, alpha=0.7) +
           geom_jitter(aes(alpha=0.8, color=state, fill=state), shape=16, size=2) +
           labs(x = NULL, y = "Flower median julian date") +
           scale_color_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "Ambient", "warmed" = "Warmed")) +
           theme_classic()) +
          theme(text = element_text(family="AvantGarde")) # doesn't work
}
flwr_overall_kbs <- flwr_overall_plot("KBS")
flwr_overall_kbs <- flwr_overall_kbs + theme(axis.text.x=element_blank())
flwr_overall_umbs <- flwr_overall_plot("UMBS")
flwr_overall_umbs <- flwr_overall_umbs + labs(y=NULL) + theme(axis.text.x=element_blank())

# flower duration plots - not including this in final plot for now since idk if its in our analyses
flwr_dur_plot <- function(loc) { 
  flower_plot <- subset(flwr_plot, site == loc)
  return(ggplot(flower_plot, aes(x = state, y = flwr_duration, fill=state)) +
           facet_grid(.~insecticide, labeller = as_labeller(insect_labels)) +
           geom_boxplot(color = "black") +
           labs(x = NULL, y = "Flower duration") +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "Ambient", "warmed" = "Warmed")) +
           theme_classic()) +
          theme(text = element_text(family="AvantGarde")) # doesn't work
}
flwr_dur_kbs <- flwr_dur_plot("KBS")
flwr_dur_umbs <- flwr_dur_plot("UMBS")

# seed set plots - using min date here bc can't calculate median date for seed
sd_overall_plot <- function(loc) { 
  seed_plot <- subset(sd_plot, site == loc)
  return(ggplot(seed_plot, aes(x = state, y = julian_min, fill=state)) +
           facet_grid(.~insecticide, labeller = as_labeller(insect_labels)) +
           geom_boxplot(outlier.shape=NA, alpha=0.7) +
           geom_jitter(aes(alpha=0.8, color=state, fill=state), shape=16, size=2) +
           labs(x = NULL, y = "Seed set minimum julian date") +
           scale_color_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "Ambient", "warmed" = "Warmed")) +
           theme_classic()) +
          theme(text = element_text(family="AvantGarde")) # doesn't work
}
sd_overall_kbs <- sd_overall_plot("KBS")
sd_overall_umbs <- sd_overall_plot("UMBS")
sd_overall_umbs <- sd_overall_umbs + labs(y=NULL)

phen_overall <- ggpubr::ggarrange(plot_overall_kbs2, plot_overall_umbs2,
                          flwr_overall_kbs, flwr_overall_umbs,
                          sd_overall_kbs, sd_overall_umbs,
                          nrow = 3, ncol = 2, legend="none")
png("greenup_plots_L2_all_phenology.png", units="in", width=8, height=8, res=300)
annotate_figure(phen_overall,
                left = text_grob("Phenological event", color = "black", rot = 90),
                bottom = text_grob("Treatment", color = "black"))
dev.off()
```

## Combining greenup, flower, and seed into one figure - plot level
## Swapping axis
```{r, echo=F}
# green-up plots
greenup_overall_plot3 <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = state, y = plot_half_cover_date, fill=state)) +
           facet_wrap(~insecticide,ncol=1) +
           geom_boxplot(color = "black") +
           labs(x = "Green-up", y = NULL, title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
                 ylim(50,300) +
           theme_classic() +
          coord_flip())
}
plot_overall_kbs3 <- greenup_overall_plot3("KBS")
plot_overall_umbs3 <- greenup_overall_plot3("UMBS")

# flower plots
flwr_overall_plot2 <- function(loc) { 
  flower_plot <- subset(flwr_plot, site == loc)
  return(ggplot(flower_plot, aes(x = state, y = julian_median, fill=state)) +
           facet_wrap(~insecticide, ncol=1) +
           geom_boxplot(color = "black") +
           labs(x = "Flower", y = NULL) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
                 ylim(50,300) +
          theme_classic() +
          coord_flip())
}
flwr_overall_kbs2 <- flwr_overall_plot2("KBS")
flwr_overall_umbs2 <- flwr_overall_plot2("UMBS")

# flower duration plots - not including this in final plot for now since idk if its in our analyses
flwr_dur_plot2 <- function(loc) { 
  flower_plot <- subset(flwr_plot, site == loc)
  return(ggplot(flower_plot, aes(x = state, y = flwr_duration, fill=state)) +
           facet_wrap(~insecticide, ncol=1) +
           geom_boxplot(color = "black") +
           labs(x = "Flower duration", y = NULL) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
          theme_classic() +
          coord_flip())
}
flwr_dur_kbs2 <- flwr_dur_plot2("KBS")
flwr_dur_umbs2 <- flwr_dur_plot2("UMBS")

# seed set plots - using min date here bc can't calculate median date for seed
sd_overall_plot2 <- function(loc) { 
  seed_plot <- subset(sd_plot, site == loc)
  return(ggplot(seed_plot, aes(x = state, y = julian_min, fill=state)) +
           facet_wrap(~insecticide, ncol=1) +
           geom_boxplot(color = "black") +
           labs(x = "Seed set", y = NULL) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) + 
                 ylim(50,300) +
          theme_classic() +
          coord_flip())
}
sd_overall_kbs2 <- sd_overall_plot2("KBS")
sd_overall_umbs2 <- sd_overall_plot2("UMBS")

phen_overall2 <- ggarrange(plot_overall_kbs3, plot_overall_umbs3,
                          flwr_overall_kbs2, flwr_overall_umbs2,
                          sd_overall_kbs2, sd_overall_umbs2,
                          nrow = 3, ncol = 2, common.legend = T, legend="right")
#png("greenup_plots_L2_all_phenology2.png", units="in", width=8, height=8, res=300)
annotate_figure(phen_overall2,
                left = text_grob("Phenological event", color = "black", rot = 90),
                bottom = text_grob("Julian date", color = "black"))
#dev.off()
```

## Combining greenup, flower, and seed into one figure - plot level
## Violin plot
```{r, echo=F, warning=F, message=F}
# green-up plots
greenup_violin <- function(loc) { 
  greenup_plot <- subset(gr_plot, site == loc)
  return(ggplot(greenup_plot, aes(x = state, y = plot_half_cover_date, fill=state)) +
           facet_wrap(~insecticide,ncol=1) +
           geom_violin(width=2, size=0.1) +
           labs(x = "Green-up", y = NULL, title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
           theme_classic() +
          coord_flip())
}
green_violin_plot_k <- greenup_violin("KBS")
green_violin_plot_u <- greenup_violin("UMBS")

# flower plots
flower_violin <- function(loc) { 
  flower_plot <- subset(flwr_plot, site == loc)
  return(ggplot(flwr_plot, aes(x = state, y = julian_median, fill=state)) +
           facet_wrap(~insecticide, ncol=1) +
           geom_violin(width=2, size=0.1) +
           labs(x = "Flower", y = NULL) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
           theme_classic() +
          coord_flip())
}
flwr_violin_plot_k <- flower_violin("KBS")
flwr_violin_plot_u <- flower_violin("UMBS")

# seed plots
seed_violin <- function(loc) { 
  seed_plot <- subset(sd_plot, site == loc)
  return(ggplot(seed_plot, aes(x = state, y = julian_min, fill=state)) +
           facet_wrap(~insecticide, ncol=1) +
           geom_violin(width=2, size=0.1) +
           labs(x = "Seed set", y = NULL) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = NULL, "warmed" = NULL)) +
           theme_classic() +
          coord_flip())
}
seed_violin_plot_k <- seed_violin("KBS")
seed_violin_plot_u <- seed_violin("UMBS")

phen_violin <- ggarrange(green_violin_plot_k, green_violin_plot_u,
                          flwr_violin_plot_k, flwr_violin_plot_u,
                          seed_violin_plot_k, seed_violin_plot_u,
                          nrow = 3, ncol = 2, common.legend = T, legend="right")
#png("greenup_plots_L2_all_phenology_violin.png", units="in", width=8, height=8, res=300)
annotate_figure(phen_violin,
                left = text_grob("Phenological event", color = "black", rot = 90),
                bottom = text_grob("Julian date", color = "black"))
#dev.off()
```

## Bar plot for greenup for KBS and UMBS - Species min cover date
```{r, echo = F}
greenup_plot_all <- function(loc) { 
  greenup_spp <- subset(sum_green_site_min, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_all("kbs")
greenup_plot_all("umbs")
```

## Box plot for greenup for KBS and UMBS - Species min cover date
```{r, echo = F}
greenup_plot_box <- function(loc) { 
  greenup_spp <- subset(gr_species, site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = min_green_date, fill = state)) +
           facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot_box("kbs")
greenup_plot_box("umbs")
```

## Plot for warmed vs ambient greenup between native and exotic - Species half cover date
```{r, echo = F}
greenup_plot_org <- function(loc) { 
  greenup_spp <- subset(sum_green_org, site == loc)
  return(ggplot(greenup_spp, aes(x = origin, y = avg_julian, fill = state)) +
           #facet_grid(.~year) +
           geom_bar(position = "dodge", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = position_dodge(0.9)) +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_org("kbs")
greenup_plot_org("umbs")     
```

## Plot for warmed vs ambient greenup between native and exotic - Plot half cover date
```{r, echo = F}
greenup_plot_org2 <- function(loc) { 
  greenup_plot <- subset(gr_origin, site == loc)
  return(ggplot(greenup_plot, aes(x = origin, y = origin_half_cover_date, fill = state)) +
           #facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}

greenup_plot_org2("kbs")
greenup_plot_org2("umbs")     
```

## Plot for warmed vs ambient greenup between growth types - Species half cover date
```{r, echo = F}
greenup_plot_habit <- function(loc) { 
  greenup_spp <- subset(sum_green_habit, site == loc)
  return(ggplot(greenup_spp, aes(x = growth_habit, y = avg_julian, fill = state)) +
           #facet_grid(.~year) +
           geom_bar(position = "dodge", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = position_dodge(0.9)) +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           coord_cartesian(ylim = c(100, 200)) +
           theme_classic())
}
greenup_plot_habit("kbs")
greenup_plot_habit("umbs")  
```

## Plot for warmed vs ambient greenup between growth types - Plot half cover date
```{r, echo = F}
greenup_plot_habit2 <- function(loc) { 
  greenup_plot <- subset(gr_growth, site == loc)
  return(ggplot(greenup_plot, aes(x = growth_habit, y = habit_half_cover_date, fill = state)) +
           #facet_grid(.~year) +
           geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}

greenup_plot_habit2("kbs")
greenup_plot_habit2("umbs")     
```

## Greenup plot for a given site and species - half cover date
### Ex: Soca at KBS, Cest at UMBS
```{r, echo = F}
greenup_plot <- function(spp, loc) { 
  greenup_spp <- subset(sum_green_spp, species == spp & site == loc)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", stat = "identity", color = "black") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup", title = spp) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           #coord_cartesian(ylim = c(100, 250)) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")) +
           theme_classic())
}
greenup_plot("Soca", "kbs")
greenup_plot("Cest", "umbs")
```


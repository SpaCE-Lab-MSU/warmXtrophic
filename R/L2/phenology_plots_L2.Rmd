---
title: "warmXtrophic Project: Phenology Plots"
author: "Moriah Young"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document: default
editor_options: 
  chunk_output_type: console
---

COLLABORATORS: Phoebe Zarnetske, Mark Hammond, Pat Bills, Kara Dobson  
DATA INPUT: Cleaned phenology data csv from the shared Google drive  
DATA OUTPUT: Code and Rmd are in the scripts folder in Github  
PROJECT: warmXtrophic  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy.opts = list(width.cutoff=80), tidy=TRUE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Clear all existing data
rm(list=ls())

#Load packages
library(tidyverse)
library(plotrix)
library(cowplot)
library(ggpubr)

# Set working directory
Sys.getenv("L1DIR")
L1_dir <- Sys.getenv("L1DIR")
L2_dir <- Sys.getenv("L2DIR")
# list.files(L1_dir)

# Read in data 
# cleaned phenology data from L1
phen_data <- read.csv(file.path(L1_dir, "phenology/final_flwr_sd_L1.csv"))

# Read in data
flwr_species <- read.csv(file.path(L2_dir, "phenology/final_flwr_species_L2.csv"))
flwr_plot <- read.csv(file.path(L2_dir, "phenology/final_flwr_plot_L2.csv"))
sd_species <- read.csv(file.path(L2_dir, "phenology/final_sd_species_L2.csv"))
sd_plot <- read.csv(file.path(L2_dir, "phenology/final_sd_plot_L2.csv"))

# delete 2021 data from dataframe -doesn't make sense to have bc we can't get min flower/sd, median flower, or 
# flower duration from 2021 UMBS since data was not collected at the same frequency as previous years
flwr_species <- flwr_species[-which(flwr_species$year == "2021" & flwr_species$site == "umbs"),]
flwr_plot <- flwr_plot[-which(flwr_plot$year == "2021" & flwr_plot$site == "umbs"),]
sd_species <- sd_species[-which(sd_species$year == "2021" & sd_species$site == "umbs"),]
sd_plot <- sd_plot[-which(sd_plot$year == "2021" & sd_plot$site == "umbs"),]

# read in GDD and temp data
GDD_KBS <- read.csv(file.path(L1_dir, "HOBO_data/KBS_GDD_L1.csv"))
flwr_temps_KBS <- read.csv(file.path(L1_dir, "HOBO_data/KBS_flower_temps_L1.csv"))
sd_temps_KBS <- read.csv(file.path(L1_dir, "HOBO_data/KBS_seed_temps_L1.csv"))
GDD_UMBS <- read.csv(file.path(L1_dir, "HOBO_data/UMBS_GDD_L1.csv"))
flwr_temps_UMBS <- read.csv(file.path(L1_dir, "HOBO_data/UMBS_flower_temps_L1.csv"))
sd_temps_UMBS <- read.csv(file.path(L1_dir, "HOBO_data/UMBS_seed_temps_L1.csv"))
# note: GDD and temp figs at the end of the script

# Set ggplot2 plotting
# This code for ggplot2 sets the theme to mostly black and white 
# (Arial font, and large font, base size=24)
theme_set(theme_bw(14))
theme_update(axis.text.x = element_text(size = 12, angle = 90),
             axis.text.y = element_text(size = 12))

# FLOWERING
# filter the data to contain the mean and std error for julian date of each site & species
sum_firstflwr_spp <- flwr_species %>%
  group_by(site, state, species, year) %>%
  summarize(avg_julian = mean(julian_min, na.rm = TRUE),
            se = std.error(julian_min, na.rm = TRUE))

# filter data to contain the averages and std error for each site
sum_firstflwr_site <- flwr_species %>%
  group_by(site, state, year) %>%
  summarize(avg_julian = mean(julian_min, na.rm = TRUE),
            se = std.error(julian_min, na.rm = TRUE))

# trying to add empty values for 2021 to umbs so the x-axis matches the other plots
sum_firstflwr_site2 <- sum_firstflwr_site
de<-data.frame("umbs", NA, "2021", NA, NA)
names(de)<-c("site","state", "year", "avg_julian", "se")
de$year <- as.integer(de$year)
sum_firstflwr_site <- rbind(sum_firstflwr_site2, de)

# Native vs Exotic
sum_firstflwr_org <- flwr_species %>%
        group_by(site, origin, state, year) %>%
        summarize(avg_julian = mean(julian_min, na.rm = TRUE),
                  se = std.error(julian_min, na.rm = TRUE))
sum_flwr_org <- subset(sum_firstflwr_org, origin == "Exotic" | origin == "Native")

# filter data to contain the averages and std error for flower duration at each site
sum_flwrduration_state <- flwr_species %>% 
        group_by(site, state, action, year) %>% 
        summarise(mean_duration = mean(flwr_duration),
                  se = std.error(flwr_duration, na.rm = TRUE))

# SEED SET
# filter date to contain mean julian date of first seed by site and species     
sum_firstsd_spp <- sd_species %>%
        group_by(site, state, species, year) %>%
        summarize(avg_julian = mean(julian_min, na.rm = TRUE),
                  se = std.error(julian_min, na.rm = TRUE))

# filter date to contain mean julian date of first seed by site
sum_firstsd_site <- sd_species %>%
        group_by(site, state, year) %>%
        summarize(avg_julian = mean(julian_min, na.rm = TRUE),
                  se = std.error(julian_min, na.rm = TRUE)) 
```

# Plots to Visualize Flowering
```{r}
flwr_line <- function(loc) { 
  flwr_plot <- subset(sum_firstflwr_site, site == loc)
  return(ggplot(flwr_plot, aes(x = year, y = avg_julian, group = state)) +
                 geom_errorbar(aes(ymin=avg_julian-se, ymax=avg_julian+se), position=position_dodge(0.1), width=.25) +
           geom_line(aes(color=state), size = 1) +
           geom_point(aes(color=state), size = 2) +
           scale_color_manual(values = c("#a6bddb", "#fb6a4a"), labels=c("Ambient","Warmed")) +
           labs(x = NULL, y = "Julian Date of First Flower", title=loc, color="Treatment") +
           ylim(150,205))
}

flwr_line_kbs <- flwr_line("kbs")
flwr_line_kbs <- flwr_line_kbs + labs(title="KBS", y=NULL) + theme(axis.text.x=element_blank())
flwr_line_umbs <- flwr_line("umbs")
flwr_line_umbs <- flwr_line_umbs + labs(title="UMBS", y=NULL)

flwr_line <- ggpubr::ggarrange(flwr_line_kbs, flwr_line_umbs,
                          nrow = 2, ncol = 1, common.legend = T, legend="bottom")
png("firstflwr_plots_L2.png", units="in", width=9, height=8, res=300)
annotate_figure(flwr_line,
                left = text_grob("Julian data of first flower", color = "black", rot = 90, size=15),
                bottom = text_grob("Year", color = "black", size=15))
dev.off()
```


Old code below
## Given species and site and for every year plot
```{r, echo = FALSE, warning=FALSE, message=FALSE}
FirstFlwr_plot <- function(spp, loc) { 
        FirstFlower_spp <- subset(sum_firstflwr_spp, species == spp & site == loc)
        return(ggplot(FirstFlower_spp, aes(x = state, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "identity", stat = "identity") +
                       geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                                     position = "identity") +
                       labs(x = "State", y = "Julian Date", title = spp, subtitle = loc) +
                       coord_cartesian(ylim = c(100, 250)) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

FirstFlwr_plot("Popr", "umbs")
FirstFlwr_plot("Popr", "kbs")
```

## Bar plot for a given site and year for average first date of flower comparing ambient vs warmed plots
```{r, echo = FALSE, warning=FALSE, message=FALSE}
sum_FirstFlwr_plot <- function(loc) { 
        FirstFlwr_sub <- subset(sum_firstflwr_site, site == loc)
        return(ggplot(FirstFlwr_sub, aes(x = state, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "identity", stat = "identity") +
                       geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                                     position = "identity") +
                       labs(x = "State", y = "Julian Date", title = "Average Julian Date of First Flower", 
                            subtitle = loc) +
                       #coord_cartesian(ylim = c(150, 180)) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_FirstFlwr_plot("kbs")
sum_FirstFlwr_plot("umbs")

# Create a plot where both kbs and umbs are on the same image
all_firstflwr_u <- sum_FirstFlwr_plot("umbs")
all_firstflwr_k <- sum_FirstFlwr_plot("kbs")

final_firstflwr_all <- ggarrange(all_firstflwr_u, all_firstflwr_k, nrow = 2, legend = "none")
annotate_figure(final_firstflwr_all,
                left = text_grob("Julian Day of First Flower", color = "black", rot = 90),
                bottom = text_grob("State", color = "black"))
```

Boxplot
```{r}
sum_FirstFlwr_boxp <- function(loc) { 
        FirstFlwr_sub <- subset(flwr_plot, site == loc)
        return(ggplot(flwr_plot, aes(x = state, y = julian_median, fill = state)) +
                       facet_grid(.~year) +
                       geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_FirstFlwr_boxp("kbs")
sum_FirstFlwr_boxp("umbs")
```


## Flowering Duration
```{r, echo=FALSE, warning=FALSE, message=FALSE}
sum_FlwrDurState_plot <- function(loc) { 
        flwr_Duration <- subset(sum_flwrduration_state, site == loc)
        return(ggplot(flwr_Duration, aes(x = state, y = mean_duration, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "identity", stat = "identity") +
                       geom_errorbar(aes(ymin = mean_duration - se, ymax = mean_duration + se), width = 0.2,
                                     position = "identity") +
                       labs(x = "State", y = "Julian Date", title = "Average Duration of Flowering", 
                            subtitle = loc) +
                       #coord_cartesian(ylim = c(150, 200)) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_FlwrDurState_plot("kbs")
sum_FlwrDurState_plot("umbs")
```
# Duration Boxplot
```{r}
sum_duration_boxp <- function(loc) { 
        duration <- subset(sum_flwrduration_state, site == loc)
        return(ggplot(sum_flwrduration_state, aes(x = state, y = mean_duration, fill = state)) +
                       facet_grid(.~year) +
                       geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_duration_boxp("kbs")
sum_duration_boxp("umbs")
```


```{r, echo=FALSE}
flwr_org_plot <- function(loc) { 
        flwr_spp <- subset(sum_flwr_org, site == loc)
        return(ggplot(flwr_spp, aes(x = origin, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "dodge", stat = "identity", color = "black") +
                       geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                                     position = position_dodge(0.9)) +
                       labs(x = "State", y = "Julian Date", 
                            title = "Native vs Exotic Avg Julian Date of First Flower", subtitle = loc) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("Exotic" = "E", "Native" = "N")))
                       #coord_cartesian(ylim = c(100, 200))
}

flwr_org_plot("kbs")
flwr_org_plot("umbs")
```
# Boxplot
```{r}
sum_org_boxp <- function(loc) { 
        duration <- subset(sum_flwr_org, site == loc)
        return(ggplot(sum_flwr_org, aes(x = origin, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_boxplot(color = "black") +
           labs(x = "State", y = "Average Julian Day of First Flower", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_org_boxp("kbs")
sum_org_boxp("umbs")
```


# Plots to Visualize Seed Set
# Plots for a given species and site and it's mean julian day of first seed for every year of data collection
```{r, echo=FALSE}
FirstSeed_plot <- function(spp, loc) { 
        FirstSeed_spp <- subset(sum_firstsd_spp, species == spp & site == loc)
        return(ggplot(FirstSeed_spp, aes(x = state, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "identity", stat = "identity") +
                       geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                                     position = "identity") +
                       labs(x = "State", y = "Julian Date", title = spp, subtitle = loc) +
                       #coord_cartesian(ylim = c(150, 300)) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

FirstSeed_plot("Popr", "umbs")
FirstSeed_plot("Popr", "kbs")
```

## Plots for a given site and year for average first date of seed comparing ambient vs warmed plots
```{r, echo=FALSE}
sum_FirstSeed_plot <- function(loc) { 
        FirstSeed_sub <- subset(sum_firstflwr_site, site == loc)
        return(ggplot(FirstSeed_sub, aes(x = state, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_bar(position = "identity", stat = "identity") +
                       geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                                     position = "identity") +
                       labs(x = "State", y = "Julian Date", title = "Average Julian Date of First Seed", 
                            subtitle = loc) +
                       coord_cartesian(ylim = c(150, 210)) +
                       scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
                       scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_FirstSeed_plot("kbs")
sum_FirstSeed_plot("umbs")

```

# Boxplot
```{r}
sum_sd_boxp <- function(loc) { 
        duration <- subset(sum_firstsd_site, site == loc)
        return(ggplot(sum_flwr_org, aes(x = origin, y = avg_julian, fill = state)) +
                       facet_grid(.~year) +
                       geom_boxplot(color = "black") +
           labs(x = "State", y = "Julian Day of Greenup", title = loc) +
           scale_fill_manual(values = c("#a6bddb", "#fb6a4a")) +
           scale_x_discrete(labels=c("ambient" = "A", "warmed" = "W")))
}

sum_org_boxp("kbs")
sum_org_boxp("umbs")
```

# GDD and temp figure - Flower
``` {r}
flwr_kbsp <- subset(flwr_plot, site == "kbs")
flwr_umbsp <- subset(flwr_plot, site == "umbs")

#removing 2015 data because there is no 2015 temperature data
flwr_kbsp <- flwr_kbsp %>%
        filter(!(year == 2015))

# Add in GDD and temp data for each year + treatment
flwr_kbsp <- left_join(flwr_kbsp, flwr_temps_KBS, by=c('year','state'))
flwr_umbsp <- left_join(flwr_umbsp, flwr_temps_UMBS, by=c('year','state'))

# cutoff dates based on HOBO_GDD_L1.R script
# basing cutoff for GDD KBS at julian date 262
GDD_flwr_KBS <- GDD_KBS %>%
        filter(julian == 262) %>%
        select(-max_temp, -min_temp, -mean_GDD_temp, -GDD_base_10, -julian)
flwr_kbsp <- left_join(flwr_kbsp, GDD_flwr_KBS, by=c('year','state'))
# basing cutoff for GDD UMBS at julian date 252
GDD_flwr_UMBS <- GDD_UMBS %>%
        filter(julian == 252) %>%
        select(-max_temp, -min_temp, -mean_GDD_temp, -GDD_base_10, -julian)
flwr_umbsp <- left_join(flwr_umbsp, GDD_flwr_UMBS, by=c('year','state'))

# looking to see which temp variable best correlates with flower dates
kbs_gdd <- ggplot(flwr_kbsp, aes(x = GDD_cumulative, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Cumulative growing degree days (GDD)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
       theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_gdd <- ggplot(flwr_umbsp, aes(x = GDD_cumulative, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Cumulative growing degree days (GDD)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_mean <- ggplot(flwr_kbsp, aes(x = mean_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Mean temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_mean <- ggplot(flwr_umbsp, aes(x = mean_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Mean temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_med <- ggplot(flwr_kbsp, aes(x = median_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Median temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_med <- ggplot(flwr_umbsp, aes(x = median_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Median temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_max <- ggplot(flwr_kbsp, aes(x = max_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Max temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_max <- ggplot(flwr_umbsp, aes(x = max_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Max temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))

gdd_temp_merge <- ggpubr::ggarrange(kbs_gdd,umbs_gdd,
                                    kbs_mean,umbs_mean,
                                    kbs_med,umbs_med,
                                    kbs_max,umbs_max,
                          ncol = 2, nrow=4,common.legend=T,legend="bottom")
png("flower_gdd_temp.png", units="in", width=7, height=8, res=300)
annotate_figure(gdd_temp_merge,
                left = text_grob("Minimum julian date of flowering", color = "black", rot = 90, size=15),
                top = text_grob("KBS                                                      UMBS", color = "black", size=15))
dev.off()

```

# GDD and temp figure - Seed
``` {r}
sd_kbsp <- subset(sd_plot, site == "kbs")
sd_umbsp <- subset(sd_plot, site == "umbs")

#removing 2015 data because there is no 2015 temperature data
sd_kbsp <- sd_kbsp %>%
        filter(!(year == 2015))

# Add in GDD and temp data for each year + treatment
sd_kbsp <- left_join(sd_kbsp, sd_temps_KBS, by=c('year','state'))
sd_umbsp <- left_join(sd_umbsp, sd_temps_UMBS, by=c('year','state'))

# cutoff dates based on HOBO_GDD_L1.R script
# basing cutoff for GDD KBS at julian date 283
GDD_sd_KBS <- GDD_KBS %>%
        filter(julian == 283) %>%
        select(-max_temp, -min_temp, -mean_GDD_temp, -GDD_base_10, -julian)
sd_kbsp <- left_join(sd_kbsp, GDD_sd_KBS, by=c('year','state'))
# basing cutoff for GDD UMBS at julian date 245
GDD_sd_UMBS <- GDD_UMBS %>%
        filter(julian == 245) %>%
        select(-max_temp, -min_temp, -mean_GDD_temp, -GDD_base_10, -julian)
sd_umbsp <- left_join(sd_umbsp, GDD_sd_UMBS, by=c('year','state'))

# looking to see which temp variable best correlates with flower dates
kbs_gdd <- ggplot(sd_kbsp, aes(x = GDD_cumulative, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Cumulative growing degree days (GDD)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
       theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_gdd <- ggplot(sd_umbsp, aes(x = GDD_cumulative, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Cumulative growing degree days (GDD)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_mean <- ggplot(sd_kbsp, aes(x = mean_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Mean temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_mean <- ggplot(sd_umbsp, aes(x = mean_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Mean temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_med <- ggplot(sd_kbsp, aes(x = median_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Median temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_med <- ggplot(sd_umbsp, aes(x = median_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Median temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
kbs_max <- ggplot(sd_kbsp, aes(x = max_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Max temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))
umbs_max <- ggplot(sd_umbsp, aes(x = max_temp, y = julian_min, color = state))+
        geom_point() +
        geom_smooth(method = 'lm', aes(fill = state)) + 
        labs(x = "Max temperature (°C)",y=NULL) +
        scale_color_manual(values = c("#a6bddb", "#fb6a4a"),
                           labels = c("Ambient","Warmed"),
                           name="Treatment") +
        scale_fill_manual(values = c("#a6bddb", "#fb6a4a"),
                          labels = c("Ambient","Warmed"),
                          name = "Treatment") +
        theme_classic() +
        theme(legend.title=element_text(size=12), 
              legend.text=element_text(size=12))

gdd_temp_merge <- ggpubr::ggarrange(kbs_gdd,umbs_gdd,
                                    kbs_mean,umbs_mean,
                                    kbs_med,umbs_med,
                                    kbs_max,umbs_max,
                          ncol = 2, nrow=4,common.legend=T,legend="bottom")
png("seed_gdd_temp.png", units="in", width=7, height=8, res=300)
annotate_figure(gdd_temp_merge,
                left = text_grob("Minimum julian date of seed set", color = "black", rot = 90, size=15),
                top = text_grob("KBS                                                      UMBS", color = "black", size=15))
dev.off()

```
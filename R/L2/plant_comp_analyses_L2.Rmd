---
title: "warmXtrophic Project: Plant Composition Analyses"
author: "Moriah Young"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=80),tidy=TRUE)
```

Load in packages & data
```{r, message = F}
rm(list=ls()) # clear all existing data

#Load packages
library(tidyverse)
library(ggplot2)
library(lme4)
library(lmerTest)
library(emmeans)
library(vegan)
library(car)
library(rstatix)
library(scales)
library(fitdistrplus)
library(moments)# for calculating skewness of data
library(ggpubr)
library(jtools) # summ() function
library(predictmeans)
library(olsrr)
library(car)
library(fitdistrplus)
library(ggpubr)
library(interactions)
library(sjPlot)
library(effects)
library(glmmTMB)
library(GGally) # ggpairs() function
library(bbmle) # AICtab() function
library(knitr)
library(GLMMadaptive)

# Set working directory
Sys.getenv("L1DIR")
L0_dir <- Sys.getenv("L0DIR")
L1_dir <- Sys.getenv("L1DIR")
L2_dir <- Sys.getenv("L2DIR")

# Read in data
comp_plot <- read.csv(file.path(L2_dir, "plant_composition/final_plant_comp_plot_L2.csv")) # plot level data
comp_plot$year_factor <- as.factor(comp_plot$year_factor)
origin_plot <- read.csv(file.path(L2_dir, "plant_composition/final_plant_comp_origin_plot_L2.csv")) # origin plot level data
origin_plot$year_factor <- as.factor(origin_plot$year_factor)
growth_plot <- read.csv(file.path(L2_dir, "plant_composition/final_plant_comp_growth_habit_plot_L2.csv")) # growth habit plot level data
growth_plot$year_factor <- as.factor(growth_plot$year_factor)

# species level plant comp
# note: the species data frame is only used to demonstrate that plant relative abundance differs between species (for the supplement)
comp_spp <- read.csv(file.path(L2_dir, "plant_composition/final_plant_comp_species_L2.csv"))
```

```{r}
# plot specific dataframes for kbs and umbs
umbs_comp_plot <- subset(comp_plot, site == "umbs") # pull out umbs only data 
kbs_comp_plot <- subset(comp_plot, site == "kbs") # pull out kbs only data 
umbs_origin_plot <- subset(origin_plot, site == "umbs") # pull out umbs only data 
kbs_origin_plot <- subset(origin_plot, site == "kbs") # pull out kbs only data 
umbs_growth_plot <- subset(growth_plot, site == "umbs") # pull out umbs only data 
kbs_growth_plot <- subset(growth_plot, site == "kbs") # pull out kbs only data 

# species specific dataframes for kbs and umbs
comp_kbs_spp <- subset(comp_spp, site == "kbs")
comp_umbs_spp <- subset(comp_spp, site == "umbs")
comp_kbs_origin_spp <- subset(comp_origin_spp, site == "kbs")
comp_umbs_origin_spp <- subset(comp_origin_spp, site == "umbs")
comp_kbs_growth_spp <- subset(comp_growth_spp, site == "kbs")
comp_umbs_growth_spp <- subset(comp_growth_spp, site == "umbs")
```

#KBS Plot Level
```{r}
### KBS ###
hist(kbs_comp_plot$avg_pc) # slightly right skewed
qqnorm(kbs_comp_plot$avg_pc)
shapiro.test(kbs_comp_plot$avg_pc) # pvalue is < 0.05 so we reject the null hypothesis that the data is normal (aka not normally distributed) 

# Exploring distributions:
descdist(kbs_comp_plot$avg_pc, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(kbs_comp_plot$avg_relative_abundance, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(kbs_comp_plot$avg_relative_abundance, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(kbs_comp_plot$avg_relative_abundance, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
# log normal best fit 
```

Leverage plots and detecting outliers
```{r}
# Plot level data
# KBS State-only model
fit_plot_state_kbs <- lm(log(avg_pc) ~ state, data = kbs_comp_plot)
outlierTest(fit_plot_state_kbs) 
qqPlot(fit_plot_state_kbs, main="QQ Plot") 
hist(fit_plot_state_kbs$residuals)
leveragePlots(fit_plot_state_kbs)
ols_test_normality(fit_plot_state_kbs) # looks ok besides Kolmogorov-Smirnov test

# KBS State and year model
fit_plot_stateyear_kbs <- lm(log(avg_pc) ~ state + year_factor, data = kbs_comp_plot)
outlierTest(fit_plot_stateyear_kbs) # no outliers 
qqPlot(fit_plot_stateyear_kbs, main="QQ Plot") 
hist(fit_plot_stateyear_kbs$residuals)
leveragePlots(fit_plot_stateyear_kbs)
ols_test_normality(fit_plot_stateyear_kbs) # a couple tests say not normal 

# Interaction plot (ignore for now the repeated measures with species); see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(log(avg_pc) ~ state * year, data = kbs_comp_plot)
interact_plot(fit3, pred = year, modx = state) # this looks very strange to me
```

Mixed Effects Model
```{r}
# KBS PLOT LEVEL
modfull <- lmer(log(avg_relative_abundance) ~ state*insecticide + year_factor + (1|plot), kbs_comp_plot, REML = FALSE)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfull) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfull) ~ kbs_comp_plot$state)
# Assumption not met
kbs_comp_plot$insecticide <- as.factor(kbs_comp_plot$insecticide)
leveneTest(residuals(modfull) ~ kbs_comp_plot$insecticide) 
# Assumption not met
kbs_comp_plot$plot <- as.factor(kbs_comp_plot$plot)
leveneTest(residuals(modfull) ~ kbs_comp_plot$plot)
# Assumption not met

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfull))
hist(residuals(modfull))
shapiro.test(resid(modfull)) # normally distributed resids bc p>0.05
outlierTest(modfull) # no outliers
```

```{r}
# testing if year as continuous or year as a factor makes more sense (test models)
year.mod.test1 <- lmer(log(avg_pc) ~ state + year + (1|plot), kbs_comp_plot, REML=FALSE)
year.mod.test2 <- lmer(log(avg_pc) ~ state + as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE)
anova(year.mod.test1, year.mod.test2) #year.mod.test2

# plot-level models 
modfull <- lmer(log(avg_pc) ~ state*as.factor(year_factor) + insecticide*year_factor + (1|plot), kbs_comp_plot, REML=F)
mod1p <- lmer(log(avg_pc) ~ state + (1|plot), kbs_comp_plot, REML=FALSE)
mod2p <- lmer(log(avg_pc) ~ insecticide + (1|plot), kbs_comp_plot, REML=FALSE)
mod3p <- lmer(log(avg_pc) ~ insecticide + state + (1|plot), kbs_comp_plot, REML=FALSE)
mod4p <- lmer(log(avg_pc) ~ insecticide * state + (1|plot), kbs_comp_plot, REML=FALSE)
mod5p <- lmer(log(avg_pc) ~ state + as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE)
mod6p <- lmer(log(avg_pc) ~ state + as.factor(year_factor) + insecticide + (1|plot), kbs_comp_plot, REML=FALSE)
mod7p <- lmer(log(avg_pc) ~ state * as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE)
mod8p <- lmer(log(avg_pc) ~ state * as.factor(year_factor) + insecticide + (1|plot), kbs_comp_plot, REML=FALSE)
mod9p <- lmer(log(avg_pc) ~ state * insecticide + as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE) #hypothesized model
mod10p <- lmer(log(avg_pc) ~ state + insecticide * as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE)
mod11p <- lmer(log(avg_pc) ~ state * as.factor(year_factor) * insecticide + (1|plot), kbs_comp_plot, REML=FALSE)

AICtab(modfull, mod1p, mod2p, mod3p, mod4p, mod5p, mod6p, mod7p, mod8p, mod9p, mod10p, mod11p, weights=T)
anova(mod5p, mod6p)

AICctab(mod5p, mod6p, weights=T) # 5p
summ(mod5p)
summary(mod5p)
anova(mod5p)
emmeans(mod5p, list(pairwise ~ state + year_factor), adjust = "tukey")
emmeans(mod5p, list(pairwise ~ state), adjust = "tukey")

```

Hypothesized model
```{r}
#Our hypothesized model is  mod9p
mod9p <- lmer(log(avg_pc) ~ state * insecticide + as.factor(year_factor) + (1|plot), kbs_comp_plot, REML=FALSE) #hypothesized model
summary(mod9p)
anova(mod9p)

# comparisons
emmeans(mod9p, list(pairwise ~ state*insecticide), adjust = "tukey")
mod9p.emm <- emmeans(mod9p, ~ state*insecticide)
contrast(mod9p.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod9p, insecticide~state)

# making a table
kable(anova(mod9p)) %>% kableExtra::kable_styling()

# calculating effect size - accounting for log transformation
exp((2.717016) +  (0.182115)*0) # 15.13509 
exp((2.717016) +  (0.182115)*1) # 18.15836
# effect:
18.15836 - 15.13509 # effect of warming - warmed plots had 3.02327 or 3.02327% more percent cover than ambient plots

# adding in our temp data into some models
# note: including state, year, and temp data into a model leads to rank deficiency
# so below, we test for avg relative abundance as a function of just temp to see how real temp data affects avg relative abundance
modtest1u <- lmer(log(avg_pc) ~ mean_temp + (1|plot), kbs_comp_plot, REML=FALSE)
modtest2u <- lmer(log(avg_pc) ~ GDD_cumulative + (1|plot), kbs_comp_plot, REML=FALSE)

AICtab(modtest1u, modtest2u, weights=T)
# growing degree days model is better but we are going to use the mean temp for all models

anova(modtest1u)
summary(modtest1u)

# calculating effect size - accounting for log transformation
exp(0.18934 + (0.17800)*0) # 1.208452 
exp(0.18934 + (0.17800)*1) # 1.443889
# effect:
1.443889 - 1.208452 # effect of warming - warmed plots had 0.235437 more percent cover than ambient plots
```

#KBS Origin Plot Level
```{r}
### KBS ###
hist(kbs_origin_plot$avg_relative_abundance)
qqnorm(kbs_origin_plot$avg_relative_abundance)
shapiro.test(kbs_origin_plot$avg_relative_abundance) # pvalue is < 0.05 so we cannot reject the null hypothesis that the data is normal (aka normally distributed) 

# Exploring distributions:
descdist(kbs_origin_plot$avg_relative_abundance, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(kbs_origin_plot$avg_relative_abundance, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(kbs_origin_plot$avg_relative_abundance, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(kbs_origin_plot$avg_relative_abundance, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
# log normal 

```

Leverage plots and detecting Outliers
```{r}
# Plot level data
# KBS State-only model
fit_plot_state_kbs <- lm(avg_relative_abundance ~ state, data = kbs_origin_plot)
outlierTest(fit_plot_state_kbs) # no outliers
qqPlot(fit_plot_state_kbs, main="QQ Plot") 
hist(fit_plot_state_kbs$residuals)
leveragePlots(fit_plot_state_kbs)
ols_test_normality(fit_plot_state_kbs) # looks ok besides Kolmogorov-Smirnov test

# KBS State and year model
fit_plot_stateyear_kbs <- lm(avg_relative_abundance ~ state + year_factor, data = kbs_origin_plot)
outlierTest(fit_plot_stateyear_kbs) # no outliers 
qqPlot(fit_plot_stateyear_kbs, main="QQ Plot") 
hist(fit_plot_stateyear_kbs$residuals)
leveragePlots(fit_plot_stateyear_kbs)
ols_test_normality(fit_plot_stateyear_kbs) # a couple tests say not normal 

# Interaction plot (ignore for now the repeated measures with species); see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(avg_relative_abundance ~ state * year, data = kbs_origin_plot)
interact_plot(fit3, pred = year, modx = state) 
```

Mixed Effects Model
```{r}
# KBS origin plot level
modfull_o <- lmer(avg_relative_abundance ~ state*insecticide*origin + factor(year_factor) + (1|plot), kbs_origin_plot, REML=F)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfull_o) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfull_o) ~ kbs_origin_plot$state)
# Assumption met
kbs_origin_plot$insecticide <- as.factor(kbs_origin_plot$insecticide)
leveneTest(residuals(modfull_o) ~ kbs_origin_plot$insecticide) 
# Assumption not met
kbs_origin_plot$plot <- as.factor(kbs_origin_plot$plot)
leveneTest(residuals(modfull_o) ~ kbs_origin_plot$plot)
# Assumption met
kbs_origin_plot$origin <- as.factor(kbs_origin_plot$origin)
leveneTest(residuals(modfull_o) ~ kbs_origin_plot$origin)
# Assumption met

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfull_o))
hist(residuals(modfull_o))
shapiro.test(resid(modfull_o)) # normally distributed resids bc p>0.05
outlierTest(modfull_o) # no outliers
```

```{r}
modfull_o <- lmer(sqrt(avg_relative_abundance) ~ state*origin + insecticide*origin + as.factor(year_factor)*origin + (1|plot), kbs_origin_plot, REML=F)
mod1p_o <- lmer(sqrt(avg_relative_abundance) ~ state*origin + insecticide*origin + as.factor(year_factor) + origin + (1|plot), kbs_origin_plot, REML=F)
mod2p_o <- lmer(sqrt(avg_relative_abundance) ~ state + insecticide*origin + as.factor(year_factor) + origin + (1|plot), kbs_origin_plot, REML=F)
mod3p_o <- lmer(sqrt(avg_relative_abundance) ~ state + insecticide + as.factor(year_factor) + origin + (1|plot), kbs_origin_plot, REML=F)
mod4p_o <- lmer(sqrt(avg_relative_abundance) ~ state + as.factor(year_factor) + origin + (1|plot), kbs_origin_plot, REML=F)
mod5p_o <- lmer(sqrt(avg_relative_abundance) ~ state + origin + (1|plot), kbs_origin_plot, REML=F)
mod6p_o <- lmer(sqrt(avg_relative_abundance) ~ state * origin + (1|plot), kbs_origin_plot, REML=F)
mod7p_o <- lmer(sqrt(avg_relative_abundance) ~ state*origin + insecticide*origin + (1|plot), kbs_origin_plot, REML=F) # hypothesis?

AICtab(modfull_o, mod1p_o, mod2p_o, mod3p_o, mod4p_o, mod5p_o, mod6p_o, mod7p_o, weights=T)
anova(mod2p_o, mod1p_o)
AICtab(mod2p_o, mod1p_o, weights=T)
anova(mod2p_o)
summary(mod2p_o)

# testing if year as continuous or year as a factor makes more sense (test models)
year.mod.testk_o1 <- lmer(sqrt(avg_relative_abundance) ~ state + year + (1|plot), kbs_origin_plot, REML=FALSE)
year.mod.testk_o2 <- lmer(sqrt(avg_relative_abundance) ~ state + year_factor + (1|plot), kbs_origin_plot, REML=FALSE)
anova(year.mod.testk_o1, year.mod.testk_o2) #year.mod.test2
```

Hypothesized model
```{r}
# hypothesized model
mod_k_o <- lmer(avg_relative_abundance ~ state * insecticide * origin + year_factor + (1|plot), kbs_origin_plot, REML=FALSE)

#mod_k_o <- glmmTMB(avg_relative_abundance ~ state * insecticide * origin + year_factor + (1|plot), data = #kbs_origin_plot, family = beta_family(), REML=FALSE)

summary(mod_k_o)
anova(mod_k_o)

# comparisons
emmeans(mod_k_o, list(pairwise ~ state*insecticide*origin), adjust = "tukey")
emmeans(mod_k_o, list(pairwise ~ state*origin), adjust = "tukey")
mod_k_o.emm <- emmeans(mod_k_o, ~ state*insecticide*origin)
contrast(mod_k_o.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod_k_o, insecticide~state)

# making a table
kable(anova(mod_k_o)) %>% kableExtra::kable_styling()
```

#KBS Growth Plot Level
```{r}
### KBS ###
hist(kbs_growth_plot$avg_relative_abundance)
qqnorm(kbs_growth_plot$avg_relative_abundance)
shapiro.test(kbs_growth_plot$avg_relative_abundance) # pvalue is > 0.05 so we can reject the null hypothesis that the data is normal (aka normally distributed) 

# Exploring distributions:
descdist(kbs_growth_plot$avg_relative_abundance, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(kbs_growth_plot$avg_relative_abundance, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(kbs_growth_plot$avg_relative_abundance, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(kbs_growth_plot$avg_relative_abundance, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
# log normal best fit
```

Leverage plots and detecting Outliers
```{r}
# Plot level data
# KBS State-only model
fit_plot_state_kbs <- lm(avg_relative_abundance ~ state, data = kbs_growth_plot)
outlierTest(fit_plot_state_kbs) # no outliers
qqPlot(fit_plot_state_kbs, main="QQ Plot") 
hist(fit_plot_state_kbs$residuals)
leveragePlots(fit_plot_state_kbs)
ols_test_normality(fit_plot_state_kbs) # looks ok besides Kolmogorov-Smirnov test

# KBS State and year model
fit_plot_stateyear_kbs <- lm(avg_relative_abundance ~ state + growth_habit, data = kbs_growth_plot)
outlierTest(fit_plot_stateyear_kbs) # no outliers 
qqPlot(fit_plot_stateyear_kbs, main="QQ Plot") 
hist(fit_plot_stateyear_kbs$residuals)
leveragePlots(fit_plot_stateyear_kbs)
ols_test_normality(fit_plot_stateyear_kbs) # a couple tests say not normal 

# Interaction plot (ignore for now the repeated measures with species); see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(avg_relative_abundance ~ state * year, data = kbs_growth_plot)
interact_plot(fit3, pred = year, modx = state) # this looks very strange to me
```

Mixed Effects Model
```{r}
# KBS growth habit plot level
modfull_g <- lmer(avg_relative_abundance ~ state*insecticide*growth_habit + year_factor + (1|plot), kbs_growth_plot, REML = FALSE)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfull_g) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfull_g) ~ kbs_growth_plot$state)
# Assumption met
kbs_growth_plot$insecticide <- as.factor(kbs_growth_plot$insecticide)
leveneTest(residuals(modfull_g) ~ kbs_growth_plot$insecticide) 
# Assumption not met
kbs_growth_plot$plot <- as.factor(kbs_growth_plot$plot)
leveneTest(residuals(modfull_g) ~ kbs_growth_plot$plot)
# Assumption met
kbs_growth_plot$growth_habit <- as.factor(kbs_growth_plot$growth_habit)
leveneTest(residuals(modfull_g) ~ kbs_growth_plot$growth_habit)
# Assumption met

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfull_g))
hist(residuals(modfull_g))
shapiro.test(resid(modfull_g)) # normally distributed resids bc p>0.05
outlierTest(modfull_g) # no outliers
```

```{r}
modfull_g <- lmer(avg_relative_abundance ~ state*growth_habit + insecticide*growth_habit + year_factor*growth_habit + (1|plot), kbs_growth_plot, REML=F)
anova(modfull_g) # significant interaction term with state and growth_habit

mod1p_g <- lmer(avg_relative_abundance~ state*growth_habit + insecticide*growth_habit + year_factor + growth_habit + (1|plot), kbs_growth_plot, REML=F)
anova(mod1p_g)
anova(mod1p_g, modfull_g)

mod2p_g <- lmer(avg_relative_abundancen ~ state*growth_habit + insecticide + year_factor*growth_habit + growth_habit + (1|plot), kbs_growth_plot, REML=F)
anova(mod2p_g)

mod3p_g <- lmer(avg_relative_abundance ~ state*growth_habit + insecticide + year_factor + growth_habit + (1|plot), kbs_growth_plot, REML=F)
anova(mod3p_g)

mod4p_g <- lmer(avg_relative_abundance ~ state + year_factor + insecticide + growth_habit + (1|plot), kbs_growth_plot, REML=F)
mod5p_g <- lmer(avg_relative_abundance ~ state + year_factor + growth_habit + (1|plot), kbs_growth_plot, REML=F) 
anova(mod4p_g, mod5p_g) # including insecticide in the model does not improve it

mod6p_g <- lmer(avg_relative_abundance ~ state + growth_habit + (1|plot), kbs_growth_plot, REML=F)
mod7p_g <- lmer(avg_relative_abundance ~ state*growth_habit + (1|plot), kbs_growth_plot, REML=F)
mod8p_g <- lmer(avg_relative_abundance ~ state*growth_habit + insecticide*growth_habit + (1|plot), kbs_growth_plot, REML=F) #hypothesis?


AICtab(modfull_g, mod1p_g, mod2p_g, mod3p_g, mod4p_g, mod5p_g, mod6p_g, mod7p_g,  weights=T)
anova(mod3p_g, mod7p_g)
AICtab(mod3p_g, mod7p_g, weights=T)
anova(mod7p_g)
summary(mod7p_g)

plot_model(mod7p_g)

# testing model that matched our hypothesis
mod_k_g <- lmer(avg_relative_abundance ~ state * insecticide * growth_habit + year_factor + (1|plot), kbs_growth_plot, REML=F)

summary(mod_k_g)
anova(mod_k_g)

# comparisons
emmeans(mod_k_g, list(pairwise ~ state*insecticide*growth_habit), adjust = "tukey")
emmeans(mod_k_g, list(pairwise ~ state*growth_habit), adjust = "tukey")
mod_k_g.emm <- emmeans(mod_k_g, ~ state*insecticide*growth_habit)
contrast(mod_k_g.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod_k_g, insecticide~state)

# making a table
kable(anova(mod_k_g)) %>% kableExtra::kable_styling()

```

#UMBS Plot Level
```{r}
### UMBS ###
hist(umbs_comp_plot$avg_pc)
qqnorm(umbs_comp_plot$avg_pc)
shapiro.test(umbs_comp_plot$avg_pc) # pvalue is < 0.05 so we reject the null hypothesis that the data is normal (aka not normally distributed) 

# Exploring distributions:
descdist(umbs_comp_plot$avg_pc, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(umbs_comp_plot$avg_pc, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(umbs_comp_plot$avg_pc, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(umbs_comp_plot$avg_pc, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
# log normal best fit 
```

Leverage plots and detecting Outliers
```{r}
# Plot level data
# UMBS State-only model
fit_plot_state_umbs <- lm(log(avg_pc) ~ state, data = umbs_comp_plot)
outlierTest(fit_plot_state_umbs) # no outliers
qqPlot(fit_plot_state_umbs, main="QQ Plot") 
hist(fit_plot_state_umbs$residuals)
leveragePlots(fit_plot_state_umbs)
ols_test_normality(fit_plot_state_umbs) # looks ok 

# UMBS State and year model
fit_plot_stateyear_umbs <- lm(log(avg_pc) ~ state + year_factor, data = umbs_comp_plot)
outlierTest(fit_plot_stateyear_umbs) # no outliers 
qqPlot(fit_plot_stateyear_umbs, main="QQ Plot") 
hist(fit_plot_stateyear_umbs$residuals)
leveragePlots(fit_plot_stateyear_umbs)
ols_test_normality(fit_plot_stateyear_umbs) 

# Interaction plot - see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(log(avg_pc) ~ state * year, data = umbs_comp_plot)
interact_plot(fit3, pred = year, modx = state) 
```

Mixed Effects Model
```{r}
# UMBS PLOT LEVEL
modfullu <- lmer(log(avg_pc) ~ state*insecticide + year_factor + (1|plot), umbs_comp_plot, REML = FALSE)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfullu) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfullu) ~ umbs_comp_plot$state)
# Assumption not met
umbs_comp_plot$insecticide <- as.factor(umbs_comp_plot$insecticide)
leveneTest(residuals(modfullu) ~ umbs_comp_plot$insecticide) 
# Assumption not met
umbs_comp_plot$plot <- as.factor(umbs_comp_plot$plot)
leveneTest(residuals(modfullu) ~ umbs_comp_plot$plot)
# Assumption not met

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfullu))
hist(residuals(modfullu))
shapiro.test(resid(modfullu)) # not normally distributed resids bc p<0.05
outlierTest(modfullu)
```

```{r}
# plot-level models 
modfullu <- lmer(log(avg_pc) ~ state*as.factor(year_factor) + insecticide*year_factor + (1|plot), umbs_comp_plot, REML=F)
mod1pu <- lmer(log(avg_pc) ~ state + (1|plot), umbs_comp_plot, REML=FALSE)
mod2pu <- lmer(log(avg_pc) ~ insecticide + (1|plot), umbs_comp_plot, REML=FALSE)
mod3pu <- lmer(log(avg_pc) ~ insecticide + state + (1|plot), umbs_comp_plot, REML=FALSE)
mod4pu <- lmer(log(avg_pc) ~ insecticide * state + (1|plot), umbs_comp_plot, REML=FALSE)
mod5pu <- lmer(log(avg_pc) ~ state + as.factor(year_factor) + (1|plot), umbs_comp_plot, REML=FALSE)
mod6pu <- lmer(log(avg_pc) ~ state + as.factor(year_factor) + insecticide + (1|plot), umbs_comp_plot, REML=FALSE)
mod7pu <- lmer(log(avg_pc) ~ state * as.factor(year_factor) + (1|plot), umbs_comp_plot, REML=FALSE)
mod8pu <- lmer(log(avg_pc) ~ state * as.factor(year_factor) + insecticide + (1|plot), umbs_comp_plot, REML=FALSE)
mod9pu <- lmer(log(avg_pc) ~ state * insecticide + as.factor(year_factor) + (1|plot), umbs_comp_plot, REML=FALSE)
mod10pu <- lmer(log(avg_pc) ~ state + insecticide * as.factor(year_factor) + (1|plot), umbs_comp_plot, REML=FALSE)
mod11pu <- lmer(log(avg_pc) ~ state * as.factor(year_factor) * insecticide + (1|plot), umbs_comp_plot, REML=FALSE)
AICtab(modfullu, mod1pu, mod2pu, mod3pu, mod4pu, mod5pu, mod6pu, mod7pu, mod8pu, mod9pu, mod10pu, mod11pu, weights=T)
anova(mod5pu, mod6pu)
AICctab(mod5pu, mod6pu, weights=T) # 5p
summ(mod5pu)
summary(mod5pu)
anova(mod5pu)
emmeans(mod5pu, list(pairwise ~ state + as.factor(year_factor)), adjust = "tukey")

#Our hypothesized model is  mod9p
summary(mod9pu)
anova(mod9pu)

# comparisons
emmeans(mod9pu, list(pairwise ~ state*insecticide), adjust = "tukey")
mod9pu.emm <- emmeans(mod9pu, ~ state*insecticide)
contrast(mod9pu.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod9pu, insecticide~state)

# code to get table information for manuscript
#table <- anova(mod5pu, mod9pu)
#kable(table) %>% kableExtra::kable_styling()
#AICctab(mod5pu, mod9pu, weights=T)

# making a table
kable(anova(mod9pu)) %>% kableExtra::kable_styling()

# adding in our temp data into some models
# note: including state, year, and temp data into a model leads to rank deficiency
# so below, we test for avg relative abundance as a function of just temp to see how real temp data affects avg relative abundance
modtest1u <- lmer(log(avg_pc) ~ mean_temp + (1|plot), umbs_comp_plot, REML=FALSE)
modtest2u <- lmer(log(avg_pc) ~ GDD_cumulative + (1|plot), umbs_comp_plot, REML=FALSE)

AICtab(modtest1u, modtest2u, weights=T)

anova(modtest1u)
summary(modtest1u)

# calculating effect size - accounting for log transformation
exp((0.35824) + (0.15702)*0) # 1.430809 
exp((0.35824) + (0.15702)*1) # 1.674074
# effect:
1.674074 - 1.430809 # 0.243265
```

#UMBS Origin Plot Level
```{r}
### UMBS ###
hist(umbs_origin_plot$avg_relative_abundance)
qqnorm(umbs_origin_plot$avg_relative_abundance)
shapiro.test(umbs_origin_plot$avg_relative_abundance) # pvalue is > 0.05 so we can reject the null hypothesis that the data is normal (aka normally distributed) 

# Exploring distributions:
descdist(umbs_origin_plot$avg_relative_abundance, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(umbs_origin_plot$avg_relative_abundance, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(umbs_origin_plot$avg_relative_abundance, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(umbs_origin_plot$avg_relative_abundance, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
# log normal best fit, but going to go with normal
```

Leverage plots and detecting Outliers
```{r}
# Plot level data
# UMBS State-only model
fit_plot_state_umbs <- lm(avg_relative_abundance ~ state, data = umbs_origin_plot)
outlierTest(fit_plot_state_umbs) # no outliers
qqPlot(fit_plot_state_umbs, main="QQ Plot") 
hist(fit_plot_state_umbs$residuals)
leveragePlots(fit_plot_state_umbs)
ols_test_normality(fit_plot_state_umbs) # looks ok besides Kolmogorov-Smirnov test

# UMBS State and year model
fit_plot_stateyear_kbs <- lm(avg_relative_abundance ~ state + year_factor, data = umbs_origin_plot)
outlierTest(fit_plot_stateyear_umbs) # no outliers 
qqPlot(fit_plot_stateyear_umbs, main="QQ Plot") 
hist(fit_plot_stateyear_umbs$residuals)
leveragePlots(fit_plot_stateyear_umbs)
ols_test_normality(fit_plot_stateyear_umbs) # a couple tests say not normal 

# Interaction plot (ignore for now the repeated measures with species); see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(avg_relative_abundance ~ state * year, data = umbs_origin_plot)
interact_plot(fit3, pred = year, modx = state) # this looks very strange to me
```

Mixed Effects Model
```{r}
# UMBS origin plot level
modfull_o_u <- lmer(avg_relative_abundance ~ state*origin + insecticide*origin + year_factor*origin + (1|plot), umbs_origin_plot, REML = FALSE)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfull_o_u) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfull_o_u) ~ umbs_origin_plot$state)
# Assumption not met
umbs_origin_plot$insecticide <- as.factor(umbs_origin_plot$insecticide)
leveneTest(residuals(modfull_o_u) ~ umbs_origin_plot$insecticide) 
# Assumption not met
umbs_origin_plot$plot <- as.factor(umbs_origin_plot$plot)
leveneTest(residuals(modfull_o_u) ~ umbs_origin_plot$plot)
# Assumption met
umbs_origin_plot$origin <- as.factor(umbs_origin_plot$origin)
leveneTest(residuals(modfull_o_u) ~ umbs_origin_plot$origin)

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfull_o_u))
hist(residuals(modfull_o_u))
shapiro.test(resid(modfull_o_u)) # not normally distributed resids bc p<0.05
outlierTest(modfull_o_u) # no outliers
```

```{r}
#Our hypothesized model
mod_1uo <- lmer(avg_relative_abundance ~ state*insecticide*origin + as.factor(year_factor) + (1|plot), umbs_origin_plot, REML = FALSE)

mod_1uo <- glmmTMB(avg_relative_abundance ~ state * insecticide * origin + year_factor + (1|plot), data = umbs_origin_plot, family = beta_family(), REML=FALSE)

summary(mod_1uo)
anova(mod_1uo)

# comparisons
emmeans(mod_1uo, list(pairwise ~ state*insecticide*origin), adjust = "tukey")
mod_1uo.emm <- emmeans(mod_1uo, ~ state*insecticide*origin)
contrast(mod_1uo.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod_1uo, insecticide~state)

# making a table
kable(anova(mod_1uo)) %>% kableExtra::kable_styling()

```

#UMBS Growth Plot Level
```{r}
### UMBS ###
hist(umbs_growth_plot$avg_relative_abundance)
qqnorm(umbs_growth_plot$avg_relative_abundance)
shapiro.test(umbs_growth_plot$avg_relative_abundance) # pvalue is > 0.05 so we can reject the null hypothesis that the data is normal (aka normally distributed) 

# Exploring distributions:
descdist(umbs_growth_plot$avg_relative_abundance, discrete = FALSE)

# Gamma distribution 
fit.gamma <- fitdist(umbs_growth_plot$avg_relative_abundance, "gamma")
plot(fit.gamma)

# Weibull distribution
fit.weibull  <- fitdist(umbs_growth_plot$avg_relative_abundance, "weibull")
plot(fit.weibull)

# Lognormal distribution 
fit.ln <- fitdist(umbs_growth_plot$avg_relative_abundance, "lnorm")
plot(fit.ln)

par(mfrow=c(2,2))
plot.legend <- c("Gamma", "Weibull", "Log Normal")
denscomp(list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
cdfcomp (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
qqcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
ppcomp  (list(fit.gamma, fit.weibull, fit.ln), legendtext = plot.legend)
dev.off()

# Goodness of fit comparisons across fits (can't include the log normal bc it becomes diff response values)
gofstat(list(fit.gamma, fit.weibull, fit.ln), fitnames = c("Gamma", "Weibull", "Log Normal"))
```

Leverage plots and detecting Outliers
```{r}
# Plot level data
# UMBS State-only model
fit_plot_state_umbs <- lm(avg_relative_abundance ~ state, data = umbs_growth_plot)
outlierTest(fit_plot_state_umbs) # no outliers
qqPlot(fit_plot_state_umbs, main="QQ Plot") 
hist(fit_plot_state_umbs$residuals)
leveragePlots(fit_plot_state_umbs)
ols_test_normality(fit_plot_state_umbs) # looks ok besides Kolmogorov-Smirnov test

# UMBS State and year model
fit_plot_stateyear_umbs <- lm(avg_relative_abundance ~ state + year_factor, data = umbs_growth_plot)
outlierTest(fit_plot_stateyear_umbs) # no outliers 
qqPlot(fit_plot_stateyear_umbs, main="QQ Plot") 
hist(fit_plot_stateyear_umbs$residuals)
leveragePlots(fit_plot_stateyear_umbs)
ols_test_normality(fit_plot_stateyear_umbs) # a couple tests say not normal 

# Interaction plot (ignore for now the repeated measures with species); see: https://cran.r-project.org/web/packages/interactions/vignettes/interactions.html and: https://interactions.jacob-long.com/

fit3 <- lm(avg_relative_abundance ~ state * year, data = umbs_growth_plot)
interact_plot(fit3, pred = year, modx = state) # this looks very strange to me
```

Mixed Effects Model
```{r}
# UMBS growth habit plot level
modfull_g_u <- lmer(avg_relative_abundance ~ state*insecticide*growth_habit + year_factor + (1|plot), umbs_growth_plot, REML = FALSE)

# Check Assumptions:
# (1) Linearity: if covariates are not categorical (year isn't)
# (2) Homogeneity: Need to Check by plotting residuals vs predicted values.
par(mfrow=c(1,2))
plot(modfull_g_u) # the ones in the data are making this look weird - idk this doesn't look great
# Homogeneity of variance looks weird here 
# Check for homogeneity of variances (true if p>0.05). If the result is not significant, the assumption of equal variances (homoscedasticity) is met (no significant difference between the group variances).
# *****Leveneâ€™s Test - tests whether or not the variance among two or more groups is equal - If the p-value is less than our chosen significance level, we can reject the null hypothesis and conclude that we have enough evidence to state that the variance among the groups is not equal (which we want).

leveneTest(residuals(modfull_g_u) ~ umbs_growth_plot$state)
# Assumption not met
umbs_growth_plot$insecticide <- as.factor(umbs_growth_plot$insecticide)
leveneTest(residuals(modfull_g_u) ~ umbs_growth_plot$insecticide) 
# Assumption not met
umbs_growth_plot$plot <- as.factor(umbs_growth_plot$plot)
leveneTest(residuals(modfull_g_u) ~ umbs_growth_plot$plot)
# Assumption met
umbs_growth_plot$growth_habit <- as.factor(umbs_growth_plot$growth_habit)
leveneTest(residuals(modfull_g_u) ~ umbs_growth_plot$growth_habit)

# (3) Normality of error term: need to check by histogram, QQplot of residuals, could do Kolmogorov-Smirnov test.
# Check for normal residuals
qqPlot(resid(modfull_g_u))
hist(residuals(modfull_g_u))
shapiro.test(resid(modfull_g_u)) # normally distributed resids bc p>0.05
outlierTest(modfull_g_u) # no outliers
```

```{r}
#Our hypothesized model
mod_1ug <- lmer(avg_relative_abundance ~ state*insecticide*growth_habit + as.factor(year_factor) + (1|plot), umbs_growth_plot, REML = FALSE)

# Trying to fit a model with beta distribution but it won't run bc values need to be 0 < y < 1 and we have some 
# values that are 1 exactly (I think that's why it won't work but not positive)
#mod_1ug <- glmmTMB(avg_relative_abundance ~ state*insecticide*growth_habit + as.factor(year_factor) + (1|plot), data = #umbs_growth_plot, family = beta_family(), REML = FALSE)

summary(mod_1ug)
anova(mod_1ug)

# comparisons
emmeans(mod_1ug, list(pairwise ~ state*insecticide*growth_habit), adjust = "tukey")
emmeans(mod_1ug, list(pairwise ~ state*growth_habit), adjust = "tukey")
mod_1ug.emm <- emmeans(mod_1ug, ~ state*insecticide*growth_habit)
contrast(mod_1ug.emm, "consec", simple = "each", combine = F, adjust = "mvt")
emmip(mod_1ug, insecticide~state)

# making a table
kable(anova(mod_1ug)) %>% kableExtra::kable_styling()
```

#Species Level Analyses
```{r}
# KBS
# species model for supp
mod_spp_k <- lmer(cover ~ state * insecticide + species + as.factor(year_factor) + (1|plot), comp_kbs_spp, REML=FALSE)
anova(mod_spp_k)
# making a table
kable(anova(mod_spp_k)) %>% kableExtra::kable_styling()

# UMBS
# species model for supp
mod_spp_u <- lmer(cover ~ state * insecticide + species + as.factor(year_factor) + (1|plot), comp_umbs_spp, REML=FALSE)
anova(mod_spp_u)
# making a table
kable(anova(mod_spp_u)) %>% kableExtra::kable_styling()

# Origin
# KBS
mod_spp_or_k <- lmer(relative ~ state * insecticide * origin + species + as.factor(year_factor) + (1|plot), comp_origin_kbs_spp, REML=FALSE)
anova(mod_spp_or_k)
# making a table
kable(anova(mod_spp_or_k)) %>% kableExtra::kable_styling()

# UMBS
mod_spp_or_u <- lmer(relative ~ state * insecticide * origin + species + as.factor(year_factor) + (1|plot), comp_umbs_origin_spp, REML=FALSE)
anova(mod_spp_or_u)
# making a table
kable(anova(mod_spp_or_u)) %>% kableExtra::kable_styling()

# Growth Habit
# KBS
mod_spp_gr_k <- lmer(relative ~ state * insecticide * growth_habit + species + as.factor(year_factor) + (1|plot), comp_kbs_growth_spp, REML=FALSE)
anova(mod_spp_gr_k)
# making a table
kable(anova(mod_spp_gr_k)) %>% kableExtra::kable_styling()

# UMBS
mod_spp_or_u <- lmer(relative ~ state * insecticide * growth_habit + species + as.factor(year_factor) + (1|plot), comp_umbs_growth_spp, REML=FALSE)
anova(mod_spp_gr_u)
# making a table
kable(anova(mod_spp_gr_u)) %>% kableExtra::kable_styling()
```


---
title: "Plant Comp Plots"
author: "Kara Dobson"
date: "12/14/2020"
output: pdf_document
---

COLLABORATORS: Phoebe Zarnetske, Mark Hammond, Pat Bills, Moriah Young  
DATA INPUT: Clean plant comp csv from the shared Google drive  
DATA OUTPUT: Plots of each graph are in the plant_comp_plots.pdf in Github  
PROJECT: warmXtrophic  
DATE: July 2020  

### Makes a function for the given species. Ex: Popr, Eugr

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load packages
library(tidyverse)
library(plotrix)

# Set working directory to Google Drive
# **** Update with the path to your Google drive on your computer
setwd("/Volumes/GoogleDrive/Shared drives/SpaCE_Lab_warmXtrophic/data/")

# Read in plant comp data & metadata
plant_comp <- read.csv("L1/plant_composition/final_plantcomp_L1.csv")
meta <- read.csv("L2/plot.csv")
#str(plant_comp) # for some reason, date column converted back to character

# Fix date column & add column for the year and julian day
plant_comp$Date <- as.Date(plant_comp$Date,format="%Y-%m-%d")
#str(plant_comp)
plant_comp$Year <- format(plant_comp$Date,format="%Y")
plant_comp$Julian <- format(plant_comp$Date, "%j")

# Make julian column numeric
plant_comp$Julian <- as.numeric(plant_comp$Julian)
#str(plant_comp)

# Change column names to lowercase so they can be merged with metadata
names(plant_comp) <- tolower(names(plant_comp))

# Merge metadata with data
plant_comp_merge <- left_join(meta, plant_comp, by = "plot")
#str(plant_comp_merge)

# Filter data to contain the date of first occurance for each species
filter_comp <- plant_comp_merge %>%
  group_by(plot, year, species, state) %>%
  summarize(julian = min(julian))

sum_comp <- filter_comp %>%
  group_by(state, species, year) %>%
  summarize(avg_julian = mean(julian, na.rm = TRUE),
            se = std.error(julian, na.rm = TRUE))
```


```{r}
greenup_plot <- function(spp) { 
  greenup_spp <- subset(sum_comp, species == spp)
  return(ggplot(greenup_spp, aes(x = state, y = avg_julian, fill = state)) +
           facet_grid(.~year) +
           geom_bar(position = "identity", alpha = 0.5, stat = "identity") +
           geom_errorbar(aes(ymin = avg_julian - se, ymax = avg_julian + se), width = 0.2,
                         position = "identity") +
           labs(x = "State", y = "Julian Day of Greenup") +
           theme_classic())
}

greenup_plot("Popr")
greenup_plot("Eugr")
```


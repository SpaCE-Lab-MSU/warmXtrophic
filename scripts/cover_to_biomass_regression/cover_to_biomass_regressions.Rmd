---
title: "Percent cover to biomass regressions"
author: "Nina K. Lany"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: pdf_document
---


```{r, include=FALSE}
#DATA PREP

# read in the data
mass <- read.csv("~/Google Drive File Stream/My Drive/warmXtrophic/data/L0/KBS/Ancillary_Data/Mass.csv", stringsAsFactors = F)
str(mass)
pc <- read.csv("~/Google Drive File Stream/My Drive/warmXtrophic/data/L0/KBS/Ancillary_Data/Percent Cover.csv", stringsAsFactors = F)
str(pc)

#read in the taxon lookup table
taxa <- read.csv("~/Google Drive File Stream/My Drive/warmXtrophic/data/L2/taxon.csv", stringsAsFactors = F)

#were the same species observed?
unique(mass$Species)
setdiff(unique(mass$Species), unique(taxa$code))
unique(pc$Species)
setdiff(unique(pc$Species), unique(taxa$code))
intersect(unique(mass$Species), unique(pc$Species))

#were the same plots observed?
unique(mass$Plot)
mass$Plot[mass$Plot=="P9 "] <- "P9" #remove trailing space
unique(pc$Plot)  #who knows?

#create unique id for each species-plot combo
mass$unique_id <- paste0(mass$Species,"_",mass$Plot)
pc$unique_id <- paste0(pc$Species,"_P",pc$Plot)

#what species-plot combinations do the two data tables have in common?
intersect(unique(mass$unique_id), unique(pc$unique_id))

pc <- pc[,c("unique_id", "Plot", "Species","Percent_Cover")]
mass <- mass[,c("unique_id", "Plot", "Species","Mass")]
dat <- merge(pc, mass, by = "unique_id", all.x=T, all.y=T)
dat <- na.omit(dat)
str(dat)
```

# Goals and Methods

Is percent cover an index of biomass?
To answer this question, we estimated percent cover and then destructively sampled biomass on $1m^2$ plots at Kellogg Biological Station in 2017.


Let's make sure I'm interpreting the data correctly.
The data gsheets are on Google Drive at `warmXtrophic/data/L0_data_entry/KBS/Ancillary_data'.
Plots are labelled P1 - P14 in the mass dataset, but are labelled 3-20 on the percent cover dataset.
I assume that plot P3 is the same as plot 3, and so on.
 
```{r, echo=TRUE}
head(mass)
head(pc)
``` 
I merged the two datasets by unique species-plot combination, which should match the percent cover measurement with dry biomass measurement for each species in each plot.
Of the 44 total taxon codes recorded in the two datasets combined, only 12 were shared by both datasets.
That's a little fishy.
Of those, only 7 taxa had both percent cover and dry biomass recorded on more than one plot.

```{r, echo=TRUE}
tapply(dat$unique_id, dat$Species.x, length)
```

# Results
```{r,fig.height = 6, fig.width=6, echo=FALSE}
spp.list <- c("Acmi", "Brin", "Cest", "Dagl", "Hisp", "Popr", "Soca")
par(mfrow = c(3,3))
par(mar = c(6,4,4,2) + 0.1)
y.lab.text <- expression(paste("Dry biomass per m"^"2"))
for(i in 1:length(spp.list)){
	d <- subset(dat, Species.x == spp.list[i])
	plot(d$Percent_Cover, d$Mass, main = spp.list[i], pch=19, bty="l", xlab = "Percent cover",  ylab = "", cex.lab=1.5) 
	mtext(y.lab.text, side=2, line=2)
}
```


# Conclusions
Percent cover and biomass appear unrelated.
A caveat, however, is that I don't know if I interpreted the data correctly.
It also makes sense to perform regressions for functional types, rather than species, but I'd like to be sure I understand the data before attempting that.